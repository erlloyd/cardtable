{"version":3,"sources":["../node_modules/peerjs/dist sync","serviceWorker.ts","constants/app-constants.ts","store/localStorage.ts","features/cards-data/initialState.ts","store/global.actions.ts","features/game/initialState.ts","features/game/game.slice.ts","features/cards-data/cards-data.slice.ts","features/cards/cards.actions.ts","utilities/geo.ts","features/cards/initialState.ts","features/cards/cards.slice.ts","features/cards-data/cards-data.selectors.ts","features/cards/cards.selectors.ts","constants/card-pack-mapping.ts","constants/game-type-properties-mapping.ts","features/cards/cards.thunks.ts","constants/card-constants.ts","features/counters/counters.actions.ts","features/counters/initialState.ts","features/counters/counters.slice.ts","store/rootReducer.ts","store/peer-js-redux-middleware.ts","store/configureStore.ts","CardTokens.tsx","CardTokensContainer.tsx","Card.tsx","ContextMenu.tsx","DeckLoader.tsx","EncounterLoader.tsx","EncounterLoaderContainer.tsx","TopLayer.tsx","CardStackCardSelector.tsx","CardStackCardSelectorContainer.tsx","Counter.tsx","PeerConnector.tsx","constants/card-missing-image-map.ts","TokenValueModifier.tsx","FirstPlayerToken.tsx","features/counters/counters.selectors.ts","FirstPlayerTokenContainer.tsx","Game.tsx","generated/packsList.ts","generated/packsList_lotr.ts","features/cards-data/cards-data.thunks.ts","features/game/game.selectors.ts","GameContainer.tsx","features/counters/counters.thunks.ts","App.tsx","AppContainer.tsx","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","Boolean","window","location","hostname","match","GameType","myPeerRef","uuidv4","possibleColors","loadState","key","serializedState","localStorage","getItem","baseState","JSON","parse","present","err","console","error","initialState","activeDataType","activeGameType","MarvelChampions","data","resetApp","createAction","receiveRemoteGameState","localStorageState","playerColors","peerId","previewCard","menuPreviewCardJsonId","stageZoom","x","y","stagePosition","gameSlice","createSlice","name","reducers","updateZoom","state","action","payload","updatePosition","connectToRemoteGame","setPlayerColor","ref","color","setPeerId","requestResync","setPreviewCardId","clearPreviewCard","setMenuPreviewCardJsonId","clearMenuPreviewCardJsonId","updateActiveGameType","quitGame","extraReducers","builder","addCase","game","actions","convertMarvelToCommonFormat","cardMarvelFormat","images","octgnId","octgn_id","quantity","doubleSided","double_sided","backLink","back_link","typeCode","type_code","subTypeCode","extraInfo","setCode","set_code","packCode","pack_code","factionCode","faction_code","convertLOTRToCommonFormat","encounterCard","cardLOTRFormat","cardBackImage","Back","ImagePath","frontImage","Front","frontImageWithoutExtension","split","slice","join","length","log","Slug","CardSet","replaceAll","RingsDbCardId","Title","front","back","OctgnGuid","Quantity","CardType","CardSubType","storeCardData","isPlayerPack","careAboutDups","cs","stateLocation","entities","encounterEntities","card","cardsDataSlice","loadCardsData","activeData","setData","SetData","forEach","set","setTypeCode","card_set_type_code","cardsInSet","LordOfTheRingsLivingCardGame","Scenarios","scenario","Product","loadCardsDataForPack","packType","isHeroPack","includes","pack","map","c","cards","loadCardsForEncounterSet","activeSet","concat","filter","cd","toLocaleLowerCase","indexOf","addCardStackWithId","pullCardOutOfCardStackWithId","drawCardsOutOfCardStackWithIds","startCardMoveWithSplitStackId","replaceCardStack","setStackShuffling","getDistance","point1","point2","deltaX","deltaY","Math","sqrt","getCenter","p1","p2","controlledBy","selected","shuffling","StatusTokenType","CounterTokenType","ghostCards","dropTargetCards","panMode","getCurrentCardData","cardsData","getCardsData","getCardsDataEntities","createSelector","getCardsDataHeroEntities","getCardsDataEncounterEntities","getCardsDataSetData","getCardsDataSetDataAsEncounterEntities","Object","entries","value","cis","getCardsDataEncounterEntitiesBySetCode","setTypesEncounters","values","push","sort","a","b","getCards","liveState","getCardMapById","reduce","getPanMode","getDropTargetCardsById","returnVal","ownerRef","CARD_PACK_REMAPPING","bkw","cap","drs","hlk","trors","twc","EXTRA_CARDS","doctor_strange","jsonId","ant","wsp","GamePropertiesMap","marvelchampions","deckSite","decklistApi","encounterUiName","tokens","stunned","menuText","menuRemoveText","imagePath","process","confused","tough","damage","threat","generic","lotrlcg","fetchDecklistById","createAsyncThunk","thunkApi","axios","get","gameType","decklistId","response","getState","getMarvelCards","getLOTRCards","heroSetCode","investigator_code","encounterCardsData","heroObligationDeck","heroEncounterDeckData","heroEncounterDeck","Array","from","_i","extraCards","position","heroId","dataId","extraHeroCards","relatedEncounterDeck","encounterDeckId","relatedObligationDeck","obligationDeckId","heroCardsData","heroStack","heroes","cardDetails","newSlots","slots","cardData","shuffle","array","temporaryValue","randomIndex","returnArray","stringify","currentIndex","floor","random","cardConstants","getCardStackWithId","find","mutateCardWithId","callback","cardToUpdate","unselectAllCardsReducer","ACTOR_REF","cardsSlice","selectCard","unselectOtherCards","unselectCard","toggleSelectCard","exhaustCard","exhausted","cardMove","movedCards","primaryCard","dx","dy","possibleDropTargets","foreachUnselectedCard","distance","c1","c2","movedCard","splice","endCardMove","dragging","cardStack","dropTargetCard","selectMultipleCards","ids","unselectAllCards","togglePanMode","flipCards","faceup","reverse","resetCards","toggleToken","cardToToggle","statusTokens","tokenType","adjustCounterToken","undefined","counterTokens","delta","cardToReplaceStack","newStack","fill","cardJsonIds","cardStackToUse","cardStackId","newCardStack","newCard","assign","cardIndexToRemove","findIndex","cardToStartMoving","splitTopCard","cardToMove","topCard","shift","splitCardId","actorRef","foreachSelectedAndControlledCard","numberToDraw","idsToUse","sourceCardStackId","index","topCardDetails","stackToUpdate","fulfilled","potentialHeroCard","heroCardStack","heroCard","mainDeckStack","cardPadding","newDeck","encounterDeck","obligationDeck","addNewCounterWithId","counters","firstPlayerCounterPosition","countersSlice","updateCounterValue","counter","removeCounter","moveCounter","newPos","moveFirstPlayerCounter","updateCounterColor","newColor","pos","undoableState","combineReducers","rootReducer","undoable","limit","groupBy","groupByActionTypes","type","excludeAction","blacklistRemoteActions","setupConnection","conn","storeAPI","on","INITIAL_STATE_MSG","setTimeout","dispatch","RESYNC","send","REMOTE_ACTION","customizedMiddleware","getDefaultMiddleware","thunk","immutableCheck","serializableCheck","activeCon","cgpPeer","Peer","debug","config","iceServers","urls","username","credential","remoteParamArray","href","remoteId","connect","metadata","setPlayerColorAction","peerConnection","onconnectionstatechange","ev","connectionState","next","desiredWidth","desiredHeight","CardTokens","props","damageImg","threatImg","genericImg","unmounted","imagesLoaded","Image","tokenInfo","currentGameType","onload","setState","src","prevProps","prevState","this","damageX","damageY","showDamage","damageToken","scale","naturalWidth","naturalHeight","width","height","fillPatternImage","damageText","text","align","verticalAlign","fontSize","threatX","threatY","showThreat","threatToken","threatText","genericX","genericY","showGeneric","Component","CardTokensContainer","HORIZONTAL_TYPE_CODES","stringArraysEqual","array1","array2","every","Card","imgs","stunnedImg","confusedImg","toughImg","touchTimer","rect","shuffleToggle","initCardImages","imgUrls","img","imageLoaded","onerror","imageLoadFailed","imgUrl","getStrokeColor","dropTargetColor","selectedColor","renderUnanimatedCard","heightToUse","widthToUse","imgToUse","i","complete","getScale","offset","native","to","rotation","animatedProps","Rect","node","cornerRadius","stroke","strokeWidth","fillPatternRotation","shouldRenderImageHorizontal","fillPatternScaleX","fillPatternScaleY","shadowForStrokeEnabled","hitStrokeWidth","opacity","isGhost","draggable","onDragStart","handleDragStart","onDragMove","handleDragMove","onDragEnd","handleDragEnd","onDblClick","handleDoubleClick","onDblTap","onClick","handleClick","onTap","onMouseDown","handleMouseDown","onTouchStart","handleTouchStart","onTouchMove","handleTouchMove","onTouchEnd","handleTouchEnd","onMouseOver","handleMouseOver","onMouseOut","handleMouseOut","onContextMenu","handleContextMenu","cardStackOffset","numCardsInStack","shouldRenderStunned","cardState","tokenImagesLoaded","stunnedToken","getTokenInSlot","confusedToken","toughToken","cardTokens","renderCardName","event","target","cancelBubble","clearTimeout","handleHover","handleHoverLeave","prevImgUrls","currentRotation","duration","renderCard","cardWidth","cardHeight","textOffset","shouldRender","slot","dimensions","stunnedOffset","typeCodes","plainCardBack","widthHorizontal","heightHorizontal","some","ContextMenu","renderMenuItem","children","parentMenuOpen","menuOpen","label","nestedI","nestedIndex","MenuItem","handleContextItemClicked","handleMenuClosed","hideContextMenu","preventDefault","item","contextItemClicked","items","Menu","keepMounted","open","onClose","anchorReference","anchorPosition","top","left","DeckLoader","inputValue","focusInputField","input","querySelector","focus","stopPropagation","handleKeyPress","loadDeckId","onKeyPress","className","TextField","onChange","variant","EncounterLoader","handleSelected","_event","questCards","encounterCards","filteredCards","oc","totalCards","loadCards","Autocomplete","options","encounterData","getOptionLabel","option","style","renderInput","params","EncounterLoaderContainer","ownProps","TopLayer","completed","containerStyle","CardStackCardSelector","cardsDataInStack","handleHighlightChange","reason","preview","clearPreview","cardSelected","cardsDataEntities","onHighlightChange","CardStackCardSelectorContainer","Counter","handleDecrement","updateCounterValueBy","handleIncrement","PeerConnector","inputRef","MISSING_CARD_IMAGE_MAP","TokenValueModifier","newValue","updated","Button","marginLeft","FirstPlayerToken","updatePos","image","getCounters","getCurrentCounters","getFirstPlayerTokenPos","FirstPlayerTokenContainer","Game","stage","lastCenter","lastDist","handleCounterValueUpdate","handleCounterDrag","noOp","renderEmptyMessage","renderContextMenu","showContextMenu","containerRect","container","getBoundingClientRect","pointerPosition","contextMenuPosition","contextMenuItems","clearContextMenu","renderDeckImporter","showDeckImporter","deckImporterPosition","clearDeckImporter","handleImportDeck","getRelativePositionFromTarget","renderEncounterImporter","showEncounterImporter","encounterImporterPosition","clearEncounterImporter","handleLoadEncounter","renderCardSearch","showCardSearch","cardSearchPosition","cardStackForSearching","clearCardSearch","handleCardSelectedFromCardStack","renderPeerConnector","showPeerConnector","peerConnectorPosition","clearPeerConnector","handlePeerConnect","renderTokenModifier","showTokenValueModifier","tokenValueModifierPosition","tokenValueModifierProps","clearTokenValueModifier","addCardStack","pullCardOutOfCardStack","handleStageClickOrTap","mousePos","selectStartPos","handleWheel","evt","oldScale","gameState","pointer","getPointerPosition","mousePointTo","newScale","handleCounterContextMenu","counterId","menuItems","handleCardContextMenu","cardId","currentStatusTokens","shuffleStack","tokenInfoForGameType","Stunned","Confused","Tough","Damage","Threat","Generic","handleCardClick","modifierKeyHeld","shiftKey","metaKey","ctrlKey","handleSelectAndExhaust","handleCardDragStart","draggingCard","hasStack","upperRightPoint","startCardMove","modifier","intCode","parseInt","Number","isNaN","mySelectedCards","drawCardsOutOfCardStack","handleKeyDown","redo","undo","getRawPreviewCardPosition","horizontal","pointerPos","screenMidPointX","innerWidth","posParam","transform","getAbsoluteTransform","copy","invert","point","button","selecting","getSelectionRectInfo","selectRect","abs","handleMouseUp","drewASelectionRect","selectedCards","currSelectedCards","Intersects","touch1","touches","touch2","handleMultiTouch","handleMouseMove","isDragging","stopDrag","clientX","clientY","newCenter","dist","pointTo","currentTarget","addNewCounter","getCardType","getCardName","cardInQuestion","getCardCode","getImgUrls","topCardData","generateLCGCDNImageUrl","codeForMissingCheck","missingImageOverride","checkMissingImageMap","unshift","Konva","hitOnDragEnabled","playmatImage","allJsonData","document","activeElement","body","el","staticCards","dropTargetCardsById","movingCards","iAmDragging","possiblePreviewCards","menuPreviewCard","previewCards","_card","isHorizontal","rawPos","previewPos","url","tabIndex","onKeyDown","Consumer","store","innerHeight","onMouseUp","onMouseMove","onWheel","codeToUse","groupCode","substring","cardCode","toLocaleUpperCase","cardSuffix","packList","getSpecificMarvelPack","packName","res","getSpecificLOTRPack","getSpecificLOTRScenario","getGame","getPlayerColors","getPeerId","getActiveGameType","getMenuPreviewCard","GameContainer","Promise","all","marvelPackList","result","status","lotrPackList","scenarioListLOTR","AllCards","payloadWithId","cardsState","s","stackToShuffle","shuffledStack","ActionCreators","possibleIds","payloadWithIds","renderGamePicker","replace","toUpperCase","_e","App","AppContainer","rtkConfigureStore","reducer","middleware","devTools","subscribe","throttle","blacklistStateKeys","setItem","saveState","configureStore","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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CA,6BACA,kCACA,wBACA,+BACA,wCACA,8BACA,oCACA,0BACA,2CACA,iCACA,2CACA,+BACA,8BACA,wBACA,yBACA,qCACA,2BACA,sCACA,4BACA,0BACA,8BACA,kCACA,wBACA,iCACA,uBACA,mCACA,yBACA,uCACA,6BACA,oCACA,kCACA,wBACA,+BACA,wCACA,8BACA,6BACA,mCACA,4BACA,8BACA,uBACA,wCACA,8BACA,mCACA,4CACA,qCACA,2BACA,oCACA,0BACA,0BACA,qCACA,+BACA,qBACA,sBACA,gCACA,0BACA,iCACA,uBACA,4BACA,sBACA,qCACA,2BACA,sBACA,4CACA,kCACA,wBACA,qCACA,wBACA,sCACA,6BACA,0BACA,mCACA,iCACA,0CACA,oCACA,0BACA,0BACA,yCACA,+BACA,kCACA,wBACA,0CACA,gCACA,8BACA,8BACA,6BACA,uCACA,6BACA,0CACA,gCACA,mCACA,8BACA,0BACA,0BACA,0BACA,iCACA,8BACA,oCACA,0BACA,0CACA,+BACA,wCACA,gDACA,uBCvFMC,GAAqB,yCAAG,WAC5BC,GAD4B,gBAAA7nB,EAAA,sEAGL0C,KAAMC,IAC3BX,mCAAyC6lB,GAJf,cAGtB/kB,EAHsB,yBAMrB,CACLglB,IAAKhlB,EACL1J,SAAUyuB,EAAS5tB,MAAM,SAAS,KARR,2CAAH,sDAYrB8tB,GAAmB,yCAAG,WAC1BF,GAD0B,gBAAA7nB,EAAA,sEAGH0C,KAAMC,IAC3BX,mCAAyC6lB,GAJjB,cAGpB/kB,EAHoB,yBAMnB,CACLglB,IAAKhlB,EACL1J,SAAUyuB,EAAS5tB,MAAM,SAAS,KARV,2CAAH,sDAYnB+tB,GAAuB,yCAAG,WAC9B3rB,GAD8B,gBAAA2D,EAAA,sEAGP0C,KAAMC,IAC3BX,6CAAmD3F,EAAW,SAJlC,cAGxByG,EAHwB,yBAMvBA,GANuB,2CAAH,sDCjGhBmlB,GAAU,SAAClxB,GAAD,OAAsBA,EAAMmB,MAMtCgwB,IAJiBhpB,aAAe+oB,IAAS,SAAC/vB,GACrD,OAAOA,EAAK5B,aAGiB4I,aAAe+oB,IAAS,SAAC/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","file":"static/js/main.3edcd1a2.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 182;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { v4 as uuidv4 } from \"uuid\";\n\nexport const myPeerRef = uuidv4();\n\nexport enum GameType {\n  MarvelChampions = \"marvelchampions\",\n  LordOfTheRingsLivingCardGame = \"lotrlcg\",\n}\n\nexport type PlayerColor =\n  | \"red\"\n  | \"cyan\"\n  | \"green\"\n  | \"blue\"\n  | \"magnenta\"\n  | \"yellow\";\n\nexport const possibleColors: PlayerColor[] = [\n  \"red\",\n  \"cyan\",\n  \"green\",\n  \"blue\",\n  \"magnenta\",\n  \"yellow\",\n];\n","import { RootState } from \"./rootReducer\";\n\nexport const loadState = (key: string) => {\n  try {\n    const serializedState = localStorage.getItem(key);\n    if (serializedState === null) {\n      return {};\n    }\n    const baseState = JSON.parse(serializedState || \"{}\");\n\n    return baseState.present ?? baseState;\n  } catch (err) {\n    console.error(\"problem parsing\");\n    return {};\n  }\n};\n\nexport const saveState = (state: RootState) => {\n  const blacklistStateKeys = [\"cardsData\"];\n  try {\n    Object.entries(state).forEach(([key, value]) => {\n      if (!blacklistStateKeys.includes(key)) {\n        const serializedState = JSON.stringify(value);\n        localStorage.setItem(key, serializedState);\n      }\n    });\n  } catch {\n    // ignore write errors\n    console.error(\"Error writing state to local storage\");\n  }\n};\n","import { GameType } from \"../../constants/app-constants\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { loadState } from \"../../store/localStorage\";\nimport { IGameState } from \"../game/initialState\";\n\nexport interface ICardData {\n  [key: string]: CardData;\n}\n\nexport interface CardInSet {\n  code: string;\n  quantity: number;\n}\n\nexport interface Set {\n  name: string;\n  setTypeCode: string;\n  cardsInSet: CardInSet[];\n}\n\nexport interface ISetData {\n  [key: string]: Set;\n}\n\nexport interface ICardsDataState {\n  activeDataType: GameType;\n  data: { [key in GameType]?: IGameCardsDataState };\n}\nexport interface IGameCardsDataState {\n  entities: ICardData;\n  encounterEntities: ICardData;\n  setData: ISetData;\n}\n\nconst localGameState: IGameState = loadState(\"game\");\n\nexport const initialState: ICardsDataState = {\n  activeDataType: localGameState.activeGameType ?? GameType.MarvelChampions,\n  data: {},\n};\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { RootState } from \"./rootReducer\";\n\nexport const resetApp = createAction(\"resetAction\");\n\nexport const receiveRemoteGameState = createAction<RootState>(\n  \"receiveRemoteGameState\"\n);\n","import { Vector2d } from \"konva/types/types\";\nimport {\n  GameType,\n  myPeerRef,\n  PlayerColor,\n} from \"../../constants/app-constants\";\nimport { loadState } from \"../../store/localStorage\";\n\nexport interface IPreviewCard {\n  id: string;\n}\n\nexport interface IGameState {\n  stageZoom: Vector2d;\n  stagePosition: Vector2d;\n  playerColors: { [key: string]: PlayerColor };\n  peerId: string;\n  previewCard: IPreviewCard | null;\n  menuPreviewCardJsonId: string | null;\n  activeGameType: GameType | null;\n}\n\nconst localStorageState: IGameState = loadState(\"game\");\nlocalStorageState.playerColors = {};\nlocalStorageState.playerColors[myPeerRef] = \"red\";\nlocalStorageState.peerId = \"\";\nlocalStorageState.previewCard = null;\nlocalStorageState.menuPreviewCardJsonId = null;\n\nconst defaultState: IGameState = {\n  playerColors: {},\n  stageZoom: { x: 0.5, y: 0.5 },\n  stagePosition: { x: 0, y: 0 },\n  peerId: \"\",\n  previewCard: null,\n  menuPreviewCardJsonId: null,\n  activeGameType: null,\n};\nexport const initialState: IGameState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { GameType, PlayerColor } from \"../../constants/app-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport { IGameState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateZoomReducer: CaseReducer<IGameState, PayloadAction<Vector2d>> = (\n  state,\n  action\n) => {\n  state.stageZoom = action.payload;\n  return state;\n};\n\nconst updatePositionReducer: CaseReducer<\n  IGameState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.stagePosition = action.payload;\n  return state;\n};\n\nconst connectToRemoteGameReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = () => {};\n\nconst setPlayerColorReducer: CaseReducer<\n  IGameState,\n  PayloadAction<{ ref: string; color: PlayerColor }>\n> = (state, action) => {\n  state.playerColors[action.payload.ref] = action.payload.color;\n};\n\nconst setPeerIdReducer: CaseReducer<IGameState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  state.peerId = action.payload;\n};\n\nconst setPreviewCardIdReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = (state, action) => {\n  if (!state.previewCard) {\n    state.previewCard = { id: action.payload };\n  } else if (state.previewCard.id !== action.payload) {\n    state.previewCard.id = action.payload;\n  }\n};\n\nconst clearPreviewCardReducer: CaseReducer<IGameState> = (state) => {\n  state.previewCard = null;\n};\n\nconst setMenuPreviewCardJsonIdReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = (state, action) => {\n  state.menuPreviewCardJsonId = action.payload;\n};\n\nconst clearMenuPreviewCardJsonIdReducer: CaseReducer<IGameState> = (state) => {\n  state.menuPreviewCardJsonId = null;\n};\n\nconst requestResyncReducer: CaseReducer<IGameState> = () => {};\n\nconst updateActiveGameTypeReducer: CaseReducer<\n  IGameState,\n  PayloadAction<GameType>\n> = (state, action) => {\n  state.activeGameType = action.payload;\n};\n\nconst quitGameReducer: CaseReducer<IGameState> = (state) => {\n  state.activeGameType = null;\n};\n\n// slice\nconst gameSlice = createSlice({\n  name: \"game\",\n  initialState: initialState,\n  reducers: {\n    updateZoom: updateZoomReducer,\n    updatePosition: updatePositionReducer,\n    connectToRemoteGame: connectToRemoteGameReducer,\n    setPlayerColor: setPlayerColorReducer,\n    setPeerId: setPeerIdReducer,\n    requestResync: requestResyncReducer,\n    setPreviewCardId: setPreviewCardIdReducer,\n    clearPreviewCard: clearPreviewCardReducer,\n    setMenuPreviewCardJsonId: setMenuPreviewCardJsonIdReducer,\n    clearMenuPreviewCardJsonId: clearMenuPreviewCardJsonIdReducer,\n    updateActiveGameType: updateActiveGameTypeReducer,\n    quitGame: quitGameReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.activeGameType = action.payload.game.activeGameType;\n    });\n    builder.addCase(resetApp, (state, action) => {\n      state.stagePosition = { x: 0, y: 0 };\n      state.stageZoom = { x: 0.5, y: 0.5 };\n      state.previewCard = null;\n    });\n  },\n});\n\nexport const {\n  updateZoom,\n  updatePosition,\n  connectToRemoteGame,\n  setPlayerColor,\n  setPeerId,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n  setMenuPreviewCardJsonId,\n  clearMenuPreviewCardJsonId,\n  updateActiveGameType,\n  quitGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","import {\n  createSlice,\n  CaseReducer,\n  PayloadAction,\n  Draft,\n} from \"@reduxjs/toolkit\";\nimport {\n  initialState,\n  ICardsDataState,\n  IGameCardsDataState,\n} from \"./initialState\";\n\n// import * as PackData from \"../../generated/packs\";\n// import { CardData as CardDataLOTR } from \"../../external-api/beorn-json-data\";\nimport {\n  CardData as CardDataMarvel,\n  CardPack as CardPackMarvel,\n} from \"../../external-api/marvel-card-data\";\nimport SetData from \"../../external/marvelsdb-json-data/sets.json\";\nimport Scenarios from \"../../external/ringsteki-json-data/scenarios.json\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { GameType } from \"../../constants/app-constants\";\nimport {\n  CardPack as CardPackLOTR,\n  CardData as CardDataLOTR,\n} from \"../../external-api/beorn-json-data\";\nimport { updateActiveGameType } from \"../game/game.slice\";\nimport { receiveRemoteGameState } from \"../../store/global.actions\";\n\n// Utilities\nconst convertMarvelToCommonFormat = (\n  cardMarvelFormat: CardDataMarvel\n): CardData => {\n  const mappedCardData: CardData = {\n    code: cardMarvelFormat.code,\n    name: cardMarvelFormat.name,\n    images: null,\n    octgnId: cardMarvelFormat.octgn_id ?? null,\n    quantity: cardMarvelFormat.quantity,\n    doubleSided: !!cardMarvelFormat.double_sided,\n    backLink: cardMarvelFormat.back_link ?? null,\n    typeCode: cardMarvelFormat.type_code,\n    subTypeCode: null,\n    extraInfo: {\n      setCode: cardMarvelFormat.set_code ?? null,\n      packCode: cardMarvelFormat.pack_code,\n      factionCode: cardMarvelFormat.faction_code,\n    },\n  };\n  return mappedCardData;\n};\n\nconst convertLOTRToCommonFormat = (encounterCard: boolean) => (\n  cardLOTRFormat: CardDataLOTR\n): CardData => {\n  // if (!cardLOTRFormat.RingsDbCardId) {\n  //   console.log(\n  //     `No RingsDB Id for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n  //   );\n  // }\n\n  // if (cardLOTRFormat.Front && !cardLOTRFormat.Front.ImagePath) {\n  //   console.log(\n  //     `No Front Image Path for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n  //   );\n  // }\n\n  let cardBackImage = cardLOTRFormat.Back?.ImagePath;\n\n  if (cardLOTRFormat.Back && !cardLOTRFormat.Back.ImagePath) {\n    const frontImage = cardLOTRFormat.Front.ImagePath;\n    const frontImageWithoutExtension = frontImage\n      .split(\".\")\n      .slice(0, -1)\n      .join(\".\");\n    if (\n      frontImageWithoutExtension[frontImageWithoutExtension.length - 1] !== \"A\"\n    ) {\n      console.log(\n        `No Non-B Back Image Path for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n      );\n    } else {\n      cardBackImage = frontImage.replaceAll(\"A.\", \"B.\");\n    }\n  }\n\n  const mappedCardData: CardData = {\n    code: encounterCard ? cardLOTRFormat.Slug : cardLOTRFormat.RingsDbCardId,\n    name: cardLOTRFormat.Title,\n    images: {\n      front: cardLOTRFormat.Front.ImagePath,\n      back: cardBackImage ?? null,\n    },\n    octgnId: cardLOTRFormat.OctgnGuid ?? null,\n    quantity: cardLOTRFormat.Quantity ?? 1,\n    doubleSided: !!cardLOTRFormat.Back,\n    backLink: null,\n    typeCode: cardLOTRFormat.CardType,\n    subTypeCode: cardLOTRFormat.CardSubType,\n    extraInfo: {\n      setCode: cardLOTRFormat.CardSet ?? null,\n      packCode: \"TODO - lotr\",\n      factionCode: encounterCard ? \"encounter\" : \"player\",\n    },\n  };\n  return mappedCardData;\n};\n\n// Reducers\nconst loadCardsDataReducer: CaseReducer<ICardsDataState> = (state) => {\n  //This reducer is only intended to be called a single time each load.\n  state.data = {};\n  // const heroPacks = Object.entries(PackData)\n  //   .filter(([key, _value]) => !key.includes(\"_encounter\"))\n  //   .map(([key, value]) => (value as unknown) as CardPackMarvel);\n\n  // const encounterPacks = Object.entries(PackData)\n  //   .filter(([key, value]) => key.includes(\"_encounter\"))\n  //   .map(([key, value]) => (value as unknown) as CardPackMarvel);\n\n  // heroPacks.forEach((pack) =>\n  //   pack.map(convertMarvelToCommonFormat).forEach((card: CardData) => {\n  //     if (state.entities[card.code]) {\n  //       console.error(\"Found multiple cards with code \" + card.code);\n  //     }\n\n  //     // if (!card.octgn_id) {\n  //     //   console.error(`Card ${card.code} had no octgn_id!`);\n  //     // }\n\n  //     state.entities[card.code] = card;\n  //   })\n  // );\n\n  // encounterPacks.forEach((pack) =>\n  //   pack.map(convertMarvelToCommonFormat).forEach((card: CardData) => {\n  //     if (state.encounterEntities[card.code]) {\n  //       console.error(\"Found multiple cards with code \" + card.code);\n  //     }\n\n  //     // if (!card.octgn_id) {\n  //     //   console.error(`Card ${card.code}: ${card.name} had no octgn_id!`);\n  //     // }\n\n  //     state.encounterEntities[card.code] = card;\n  //   })\n  // );\n\n  let activeData = state.data[GameType.MarvelChampions];\n  if (!!activeData) {\n    activeData.setData = {};\n  } else {\n    state.data[GameType.MarvelChampions] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n    activeData = state.data[GameType.MarvelChampions];\n  }\n\n  SetData.forEach((set) => {\n    if (!!activeData) {\n      activeData.setData[set.code] = {\n        name: set.name,\n        setTypeCode: set.card_set_type_code,\n        cardsInSet: [],\n      };\n    }\n  });\n\n  activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n\n  if (!!activeData) {\n    activeData.setData = {};\n  } else {\n    state.data[GameType.LordOfTheRingsLivingCardGame] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n    activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n  }\n\n  Scenarios.forEach((scenario) => {\n    if (!!activeData) {\n      activeData.setData[scenario.Slug] = {\n        name: scenario.Title,\n        setTypeCode: scenario.Product,\n        cardsInSet: [],\n      };\n    }\n  });\n\n  return state;\n};\n\nconst storeCardData = (isPlayerPack: boolean, careAboutDups: boolean) => (cs: {\n  location: Draft<IGameCardsDataState> | undefined;\n  card: CardData;\n}) => {\n  const stateLocation = isPlayerPack\n    ? (cs.location as IGameCardsDataState).entities\n    : (cs.location as IGameCardsDataState).encounterEntities;\n\n  // if (!card.octgn_id) {\n  //   console.error(`Card ${card.code} had no octgn_id!`);\n  // }\n\n  if (!(cs.card.code[0] === \"0\" && cs.card.code[1] === \"0\")) {\n    if (stateLocation[cs.card.code]) {\n      if (careAboutDups) {\n        console.error(\n          \"Found multiple cards with code \" +\n            cs.card.code +\n            \" \" +\n            cs.card.name +\n            \" \" +\n            cs.card.extraInfo.setCode +\n            \" Existing card is \" +\n            stateLocation[cs.card.code].name +\n            \" \" +\n            stateLocation[cs.card.code].extraInfo.setCode\n        );\n      }\n    }\n    stateLocation[cs.card.code] = cs.card;\n  }\n};\n\nconst loadCardsForEncounterSetReducer: CaseReducer<\n  ICardsDataState,\n  PayloadAction<{\n    setCode: string;\n    cards: CardDataLOTR[];\n  }>\n> = (state, action) => {\n  const activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n  const activeSet = activeData?.setData[action.payload.setCode];\n\n  if (!action.payload.cards.map) {\n    console.log(\"No cards found for scenario \" + action.payload.setCode);\n    return;\n  }\n\n  action.payload.cards\n    .map(convertLOTRToCommonFormat(true))\n    .map((c) => {\n      return {\n        location: state.data[GameType.LordOfTheRingsLivingCardGame],\n        card: c,\n      };\n    })\n    .forEach(storeCardData(false, false));\n\n  if (!!activeSet) {\n    activeSet.cardsInSet = activeSet.cardsInSet.concat(\n      action.payload.cards\n        .filter(\n          (cd) => cd.CardSet.toLocaleLowerCase().indexOf(\"nightmare\") === -1\n        )\n        .map((cd) => {\n          return {\n            code: cd.Slug,\n            quantity: cd.Quantity,\n          };\n        })\n    );\n  }\n\n  return state;\n};\n\nconst loadCardsDataForPackReducer: CaseReducer<\n  ICardsDataState,\n  PayloadAction<{\n    packType: GameType;\n    pack: CardPackMarvel | CardPackLOTR;\n    pack_code: string;\n  }>\n> = (state, action) => {\n  if (!state.data[action.payload.packType]) {\n    state.data[action.payload.packType] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n  }\n\n  if (action.payload.packType === GameType.MarvelChampions) {\n    //This reducer is only intended to be called a single time each load.\n    const isHeroPack = !action.payload.pack_code.includes(\"_encounter\");\n\n    const pack = action.payload.pack as CardPackMarvel;\n\n    pack\n      .map(convertMarvelToCommonFormat)\n      .map((c) => {\n        return { location: state.data[action.payload.packType], card: c };\n      })\n      .forEach(storeCardData(isHeroPack, true));\n  } else if (\n    action.payload.packType === GameType.LordOfTheRingsLivingCardGame\n  ) {\n    const pack = action.payload.pack as CardPackLOTR;\n    if (!pack.cards) {\n      console.log(pack);\n    }\n    pack.cards\n      .map(convertLOTRToCommonFormat(false))\n      .map((c) => {\n        return { location: state.data[action.payload.packType], card: c };\n      })\n      .forEach(storeCardData(true, true));\n  }\n\n  return state;\n};\n\n// slice\nconst cardsDataSlice = createSlice({\n  name: \"cardsData\",\n  initialState: initialState,\n  reducers: {\n    loadCardsData: loadCardsDataReducer,\n    loadCardsDataForPack: loadCardsDataForPackReducer,\n    loadCardsForEncounterSet: loadCardsForEncounterSetReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.activeDataType =\n        action.payload.game.activeGameType ?? GameType.MarvelChampions;\n    });\n    builder.addCase(updateActiveGameType, (state, action) => {\n      state.activeDataType = action.payload;\n    });\n  },\n});\n\nexport const {\n  loadCardsData,\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} = cardsDataSlice.actions;\n\nexport default cardsDataSlice.reducer;\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { ICardDetails } from \"./initialState\";\n\nexport interface AddCardStackWithIdPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n  id: string;\n}\n\nexport interface PullCardOutOfCardStackWithIdPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n  id: string;\n}\n\nexport interface StartCardMoveWithSplitStackIdPayload {\n  id: string;\n  splitTopCard: boolean;\n  splitCardId: string;\n}\n\nexport interface DrawCardsOutOfCardStackWithIdsPayload {\n  cardStackId: string;\n  numberToDraw: number;\n  idsToUse: string[];\n}\n\nexport interface ReplaceCardStackPayload {\n  id: string;\n  newStack: ICardDetails[];\n}\n\nexport const addCardStackWithId = createAction<AddCardStackWithIdPayload>(\n  \"addCardStackWithId\"\n);\n\nexport const pullCardOutOfCardStackWithId = createAction<PullCardOutOfCardStackWithIdPayload>(\n  \"pullCardOutOfCardStackWithId\"\n);\n\nexport const drawCardsOutOfCardStackWithIds = createAction<DrawCardsOutOfCardStackWithIdsPayload>(\n  \"drawCardsOutOfCardStackWithIds\"\n);\n\nexport const startCardMoveWithSplitStackId = createAction<StartCardMoveWithSplitStackIdPayload>(\n  \"startCardMoveWithSplitStackId\"\n);\n\nexport const replaceCardStack = createAction<ReplaceCardStackPayload>(\n  \"replaceCardStack\"\n);\n\nexport const setStackShuffling = createAction<{\n  id: string;\n  shuffling: boolean;\n}>(\"setStackShuffling\");\n","import { Vector2d } from \"konva/types/types\";\n\nexport const getDistance = (point1: Vector2d, point2: Vector2d): number => {\n  const deltaX = point1.x - point2.x;\n  const deltaY = point1.y - point2.y;\n  return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n};\n\nexport const getCenter = (p1: Vector2d, p2: Vector2d) => {\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2,\n  };\n};\n","import { loadState } from \"../../store/localStorage\";\nimport { CounterTokenType, StatusTokenType } from \"./cards.slice\";\n\nexport interface ICardStack {\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  faceup: boolean;\n  fill: string;\n  id: string;\n  selected: boolean;\n  x: number;\n  y: number;\n  cardStack: ICardDetails[];\n  statusTokens: {\n    [K in StatusTokenType]: boolean;\n  };\n  counterTokens: {\n    [K in CounterTokenType]: number;\n  };\n}\n\nexport interface ICardDetails {\n  jsonId: string;\n}\n\nexport interface ICardsState {\n  cards: ICardStack[];\n  ghostCards: ICardStack[];\n  dropTargetCards: { [key: string]: ICardStack | null };\n  panMode: boolean;\n}\n\nconst localStorageState: ICardsState = loadState(\"liveState\")?.cards ?? {};\n\n// Make sure initially, none of the cards are \"owned\" / \"selected\" / \"shuffling\"\nif (!!localStorageState.cards) {\n  localStorageState.cards.forEach((c) => {\n    c.controlledBy = \"\";\n    c.selected = false;\n    c.shuffling = false;\n  });\n}\n\nconst defaultState: ICardsState = {\n  cards: [],\n  ghostCards: [],\n  dropTargetCards: {},\n  panMode: true,\n};\n\nexport const initialState: ICardsState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { createSlice, PayloadAction, CaseReducer } from \"@reduxjs/toolkit\";\nimport { getDistance } from \"../../utilities/geo\";\nimport {\n  initialState,\n  ICardsState,\n  ICardStack,\n  ICardDetails,\n} from \"./initialState\";\nimport { fetchDecklistById } from \"./cards.thunks\";\nimport { cardConstants } from \"../../constants/card-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport {\n  addCardStackWithId,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\n\nconst CARD_DROP_TARGET_DISTANCE = 30;\n\nexport enum StatusTokenType {\n  Stunned = \"stunned\",\n  Confused = \"confused\",\n  Tough = \"tough\",\n}\n\nexport enum CounterTokenType {\n  Damage = \"damage\",\n  Threat = \"threat\",\n  Generic = \"generic\",\n}\n\n// Helper methods\nconst getCardStackWithId = (\n  state: ICardsState,\n  id: string\n): ICardStack | undefined => {\n  return state.cards.find((card) => card.id === id);\n};\n\nconst mutateCardWithId = (\n  state: ICardsState,\n  id: string,\n  ref: string,\n  callback: (card: ICardStack) => void\n) => {\n  const cardToUpdate = getCardStackWithId(state, id);\n  if (\n    cardToUpdate &&\n    (cardToUpdate.controlledBy === \"\" || cardToUpdate.controlledBy === ref)\n  ) {\n    callback(cardToUpdate);\n  }\n};\n\nconst foreachSelectedAndControlledCard = (\n  state: ICardsState,\n  actorRef: string,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => card.selected && card.controlledBy === actorRef)\n    .forEach((card) => callback(card));\n};\n\nconst foreachUnselectedCard = (\n  state: ICardsState,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => !card.selected)\n    .forEach((card) => callback(card));\n};\n\n// Reducers\nconst selectCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; unselectOtherCards: boolean }>\n> = (state, action) => {\n  if (action.payload.unselectOtherCards) {\n    unselectAllCardsReducer(state, action);\n  }\n\n  mutateCardWithId(\n    state,\n    action.payload.id,\n    (action as any).ACTOR_REF,\n    (card) => {\n      card.selected = true;\n      card.controlledBy = (action as any).ACTOR_REF;\n    }\n  );\n};\n\nconst unselectCardReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  mutateCardWithId(state, action.payload, (action as any).ACTOR_REF, (card) => {\n    card.selected = false;\n    card.controlledBy = \"\";\n  });\n};\n\nconst toggleSelectCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<string>\n> = (state, action) => {\n  mutateCardWithId(state, action.payload, (action as any).ACTOR_REF, (card) => {\n    card.selected = !card.selected;\n    if (!card.selected) {\n      card.controlledBy = \"\";\n    } else {\n      card.controlledBy = (action as any).ACTOR_REF;\n    }\n  });\n};\n\nconst exhaustCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<string | undefined>\n> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === (action as any).ACTOR_REF &&\n        (card.id === (action.payload ?? \"\") || card.selected)\n    )\n    .forEach((card) => {\n      card.exhausted = !card.exhausted;\n    });\n};\n\nconst cardMoveReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; dx: number; dy: number }>\n> = (state, action) => {\n  const movedCards: ICardStack[] = [];\n\n  let primaryCard: ICardStack | null = null;\n\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload.id ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      if (card.id === action.payload.id) {\n        primaryCard = card;\n      }\n\n      card.x += action.payload.dx;\n      card.y += action.payload.dy;\n\n      movedCards.push(card);\n    });\n\n  // go through and find if any unselected cards are potential drop targets\n  // If so, get the closest one. But only if the card is owned / controlled by us\n  const possibleDropTargets: { distance: number; card: ICardStack }[] = [];\n  if (\n    !!primaryCard &&\n    (primaryCard as ICardStack).controlledBy === (action as any).ACTOR_REF\n  ) {\n    foreachUnselectedCard(state, (card) => {\n      const distance = getDistance(\n        { x: card.x, y: card.y },\n        !!primaryCard ? { x: primaryCard.x, y: primaryCard.y } : { x: 0, y: 0 }\n      );\n      if (distance < CARD_DROP_TARGET_DISTANCE) {\n        possibleDropTargets.push({\n          distance,\n          card,\n        });\n      }\n    });\n  }\n\n  state.dropTargetCards[(action as any).ACTOR_REF] =\n    possibleDropTargets.sort((c1, c2) => c1.distance - c2.distance)[0]?.card ??\n    null;\n\n  // put the moved cards at the end. TODO: we could just store the move order or move time\n  // or something, and the array could be a selector\n  movedCards.forEach((movedCard) => {\n    state.cards.push(state.cards.splice(state.cards.indexOf(movedCard), 1)[0]);\n  });\n};\n\nconst endCardMoveReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  let dropTargetCards: ICardDetails[] = [];\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.dragging = false;\n\n      if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n        // Add the cards to the drop Target card stack\n        dropTargetCards = dropTargetCards.concat(card.cardStack);\n      }\n    });\n\n  // Now, if there was a drop target card, remove all those cards from the state\n  if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n    state.cards = state.cards.filter(\n      (card) =>\n        !(\n          card.id === action.payload ||\n          (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n        )\n    );\n\n    const dropTargetCard = state.cards.find(\n      (card) => card.id === state.dropTargetCards[(action as any).ACTOR_REF]?.id\n    );\n    if (!!dropTargetCard && dropTargetCards.length > 0) {\n      // add the cards we've collected to the top of the stack\n      dropTargetCard.cardStack = dropTargetCards.concat(\n        dropTargetCard.cardStack\n      );\n    }\n  }\n\n  state.ghostCards = [];\n  state.dropTargetCards[(action as any).ACTOR_REF] = null;\n};\n\nconst selectMultipleCardsReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ ids: string[] }>\n> = (state, action) => {\n  action.payload.ids\n    .map((id) => state.cards.find((card) => card.id === id))\n    .forEach((card) => {\n      if (\n        card &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n      ) {\n        card.selected = true;\n        card.controlledBy = (action as any).ACTOR_REF;\n      }\n    });\n};\n\nconst unselectAllCardsReducer: CaseReducer<ICardsState, PayloadAction<any>> = (\n  state,\n  action\n) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === \"\" ||\n        card.controlledBy === (action as any).ACTOR_REF\n    )\n    .forEach((card) => {\n      card.selected = false;\n      card.controlledBy = \"\";\n    });\n};\n\nconst togglePanModeReducer: CaseReducer<ICardsState> = (state) => {\n  state.panMode = !state.panMode;\n};\n\nconst flipCardsReducer: CaseReducer<ICardsState> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.selected &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.faceup = !card.faceup;\n      card.cardStack = card.cardStack.reverse();\n    });\n};\n\nconst resetCardsReducer: CaseReducer<ICardsState> = (state) => {\n  state.cards = [];\n};\n\nconst toggleTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; tokenType: StatusTokenType; value: boolean }>\n> = (state, action) => {\n  const cardToToggle = state.cards.find((c) => c.id === action.payload.id);\n  if (!!cardToToggle) {\n    cardToToggle.statusTokens[action.payload.tokenType] = action.payload.value;\n  }\n};\n\nconst adjustCounterTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }>\n> = (state, action) => {\n  let cardsToToggle = state.cards.filter(\n    (c) =>\n      (!!action.payload.id && action.payload.id === c.id) ||\n      (c.selected && c.controlledBy === (action as any).ACTOR_REF)\n  );\n\n  cardsToToggle.forEach((c) => {\n    if (action.payload.value !== undefined) {\n      c.counterTokens[action.payload.tokenType] = action.payload.value;\n    } else if (action.payload.delta !== undefined) {\n      c.counterTokens[action.payload.tokenType] += action.payload.delta;\n    }\n    if (c.counterTokens[action.payload.tokenType] < 0) {\n      c.counterTokens[action.payload.tokenType] = 0;\n    }\n  });\n};\n// Selectors\n\n// slice\nconst cardsSlice = createSlice({\n  name: \"cards\",\n  initialState: initialState,\n  reducers: {\n    selectCard: selectCardReducer,\n    unselectCard: unselectCardReducer,\n    toggleSelectCard: toggleSelectCardReducer,\n    exhaustCard: exhaustCardReducer,\n    cardMove: cardMoveReducer,\n    endCardMove: endCardMoveReducer,\n    selectMultipleCards: selectMultipleCardsReducer,\n    unselectAllCards: unselectAllCardsReducer,\n    togglePanMode: togglePanModeReducer,\n    flipCards: flipCardsReducer,\n    resetCards: resetCardsReducer,\n    toggleToken: toggleTokenReducer,\n    adjustCounterToken: adjustCounterTokenReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      // TODO: find a way to keep this automatic\n      state.cards = action.payload.liveState.present.cards.cards;\n      state.ghostCards = action.payload.liveState.present.cards.ghostCards;\n    });\n\n    builder.addCase(replaceCardStack, (state, action) => {\n      const cardToReplaceStack = state.cards.find(\n        (c) => c.id === action.payload.id\n      );\n      if (!!cardToReplaceStack) {\n        cardToReplaceStack.cardStack = action.payload.newStack;\n      }\n    });\n\n    builder.addCase(resetApp, (state) => {\n      state.cards = [];\n      // state.previewCard = null;\n      state.dropTargetCards = {};\n      state.ghostCards = [];\n      state.panMode = true;\n    });\n\n    builder.addCase(addCardStackWithId, (state, action) => {\n      const newStack: ICardStack = {\n        controlledBy: \"\",\n        x: action.payload.position.x,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.id,\n        cardStack: action.payload.cardJsonIds.map((jsonId) => ({\n          jsonId,\n        })),\n        selected: false,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      state.cards.push(newStack);\n    });\n\n    builder.addCase(pullCardOutOfCardStackWithId, (state, action) => {\n      const cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n      if (!!cardStackToUse && cardStackToUse.cardStack.length > 1) {\n        const newCardStack: ICardDetails[] = [\n          { jsonId: action.payload.jsonId },\n        ];\n        const newCard = Object.assign({}, cardStackToUse, {\n          cardStack: newCardStack,\n        });\n        newCard.id = action.payload.id;\n        newCard.selected = true;\n        newCard.controlledBy = (action as any).ACTOR_REF;\n        newCard.x = newCard.x + cardConstants.CARD_WIDTH + 5;\n\n        // Find the first instance of the card with the json id. Note that because there\n        // might be multiple cards with the same json id, we can't just do a filter\n        const cardIndexToRemove = cardStackToUse.cardStack.findIndex(\n          (c) => c.jsonId === action.payload.jsonId\n        );\n\n        if (cardIndexToRemove !== -1) {\n          cardStackToUse.cardStack.splice(cardIndexToRemove, 1);\n        }\n\n        cardStackToUse.selected = false;\n        cardStackToUse.controlledBy = \"\";\n\n        state.cards.push(newCard);\n      }\n    });\n\n    builder.addCase(startCardMoveWithSplitStackId, (state, action) => {\n      // first, if the card moving isn't currently selected, clear all _our_ selected cards\n      const cardToStartMoving = getCardStackWithId(state, action.payload.id);\n      if (cardToStartMoving && !cardToStartMoving.selected) {\n        state.cards = state.cards.map((card) => {\n          if (\n            card.controlledBy === \"\" ||\n            card.controlledBy === (action as any).ACTOR_REF\n          ) {\n            card.selected = card.id === action.payload.id;\n            if (card.selected) {\n              card.controlledBy = (action as any).ACTOR_REF;\n            } else {\n              card.controlledBy = \"\";\n            }\n          }\n          return card;\n        });\n      }\n\n      // If we are splitting, make a new stack of cards\n      if (action.payload.splitTopCard) {\n        const cardToMove = state.cards.find((c) => c.id === action.payload.id);\n\n        if (!cardToMove) {\n          throw new Error(\"Expected to find card\");\n        }\n\n        cardToMove.selected = false;\n        cardToMove.controlledBy = \"\";\n\n        const topCard = cardToMove.cardStack.shift();\n        const newCard = Object.assign({}, cardToMove, {\n          selected: true,\n          controlledBy: (action as any).ACTOR_REF,\n          dragging: true,\n          cardStack: [topCard],\n        });\n\n        cardToMove.id = action.payload.splitCardId;\n\n        state.cards.push(newCard);\n      }\n\n      // Now all selected cards should be put into ghost cards, unless we are splitting the top card\n      state.ghostCards = [];\n\n      if (!action.payload.splitTopCard) {\n        foreachSelectedAndControlledCard(\n          state,\n          (action as any).ACTOR_REF,\n          (card) => {\n            card.dragging = true;\n            state.ghostCards.push(Object.assign({}, card));\n          }\n        );\n      }\n\n      //Finally, if we have a preview card, clear it\n      // state.previewCard = null;\n    });\n\n    builder.addCase(drawCardsOutOfCardStackWithIds, (state, action) => {\n      if (action.payload.numberToDraw !== action.payload.idsToUse.length) {\n        throw new Error(\"Did not receive the expected number of ids\");\n      }\n\n      // First, unselect everything else of ours\n      unselectAllCardsReducer(state, (action as unknown) as any);\n\n      // Get the cardstack in question\n      let cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n\n      if (!cardStackToUse) {\n        throw new Error(\n          `Couldn't find card stack with id ${action.payload.cardStackId}`\n        );\n      }\n\n      const sourceCardStackId = cardStackToUse.id;\n\n      //Next, for each card we should draw, remove it from the stack and make a new stack, which should be selected\n      for (let index = 0; index < action.payload.numberToDraw; index++) {\n        if (!!cardStackToUse) {\n          const topCardDetails = cardStackToUse.cardStack.shift();\n          if (!topCardDetails) {\n            throw new Error(\"Expected to find a top card, but didn't\");\n          }\n          const newCardStack: ICardDetails[] = [\n            { jsonId: topCardDetails.jsonId },\n          ];\n          const newCard = Object.assign({}, cardStackToUse, {\n            cardStack: newCardStack,\n          });\n          newCard.id = action.payload.idsToUse[index];\n          newCard.selected = true;\n          newCard.controlledBy = (action as any).ACTOR_REF;\n          newCard.faceup = true;\n          newCard.x = newCard.x + (cardConstants.CARD_WIDTH + 5) * (index + 1);\n          newCard.y += cardConstants.CARD_HEIGHT;\n\n          if (cardStackToUse.cardStack.length === 0) {\n            // we went through all the cards, remove the original card\n            state.cards = state.cards.filter((c) => c.id !== sourceCardStackId);\n            cardStackToUse = undefined;\n          }\n\n          state.cards.push(newCard);\n        }\n      }\n    });\n\n    builder.addCase(setStackShuffling, (state, action) => {\n      // get the stack to update\n      const stackToUpdate = state.cards.find((c) => c.id === action.payload.id);\n\n      if (!!stackToUpdate) {\n        stackToUpdate.shuffling = action.payload.shuffling;\n      }\n    });\n\n    builder.addCase(fetchDecklistById.fulfilled, (state, action) => {\n      console.log(\"got decklist\");\n      console.log(action);\n\n      const potentialHeroCard: ICardDetails[] = action.payload.data\n        .investigator_code\n        ? [{ jsonId: action.payload.data.investigator_code }]\n        : [];\n\n      const heroCardStack = [\n        ...potentialHeroCard,\n        ...action.payload.extraHeroCards,\n      ];\n\n      const heroCard: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.heroId,\n        cardStack: heroCardStack,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      let mainDeckStack: ICardDetails[] = [];\n      Object.entries(action.payload.data.slots).forEach(([key, value]) => {\n        const cardDetails: ICardDetails[] = Array.from(Array(value).keys()).map(\n          (): ICardDetails => ({ jsonId: key })\n        );\n        mainDeckStack = mainDeckStack.concat(cardDetails);\n      });\n\n      const cardPadding = cardConstants.CARD_WIDTH + 10;\n\n      const newDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.dataId,\n        cardStack: mainDeckStack,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      const encounterDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding * 2,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.encounterDeckId,\n        cardStack: action.payload.relatedEncounterDeck.map((jsonId) => ({\n          jsonId,\n        })),\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      const obligationDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding * 3,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.obligationDeckId,\n        cardStack: action.payload.relatedObligationDeck.map((jsonId) => ({\n          jsonId,\n        })),\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      if (heroCard.cardStack.length > 0) {\n        state.cards.push(heroCard);\n      }\n\n      if (newDeck.cardStack.length > 0) {\n        state.cards.push(newDeck);\n      }\n\n      if (encounterDeck.cardStack.length > 0) {\n        state.cards.push(encounterDeck);\n      }\n\n      if (obligationDeck.cardStack.length > 0) {\n        state.cards.push(obligationDeck);\n      }\n    });\n  },\n});\n\nexport const {\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  exhaustCard,\n  cardMove,\n  endCardMove,\n  selectMultipleCards,\n  unselectAllCards,\n  togglePanMode,\n  flipCards,\n  resetCards,\n  toggleToken,\n  adjustCounterToken,\n} = cardsSlice.actions;\n\nexport default cardsSlice.reducer;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardsDataState, Set } from \"../cards-data/initialState\";\n\nexport interface IEncounterEntity {\n  setCode: string;\n  setData: Set;\n  cards: CardData[];\n}\n\nconst getCurrentCardData = (cardsData: ICardsDataState) => {\n  return (\n    cardsData.data[cardsData.activeDataType] ?? {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    }\n  );\n};\n\nexport const getCardsData = (state: RootState) => state.cardsData;\n\nexport const getCardsDataEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return { ...data.entities, ...data.encounterEntities };\n  }\n);\n\nexport const getCardsDataHeroEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return data.entities;\n  }\n);\n\nexport const getCardsDataEncounterEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return data.encounterEntities;\n  }\n);\n\nexport const getCardsDataSetData = createSelector(getCardsData, (cardsData) => {\n  const data = getCurrentCardData(cardsData);\n  return data.setData;\n});\n\nexport const getCardsDataSetDataAsEncounterEntities = createSelector(\n  getCardsDataSetData,\n  getCardsDataEncounterEntities,\n  (setData, encounterEntities) => {\n    return Object.entries(setData).map(([key, value]) => {\n      const encounterEntity: IEncounterEntity = {\n        setCode: key,\n        setData: value,\n        cards: value.cardsInSet.map((cis) => encounterEntities[cis.code]),\n      };\n\n      return encounterEntity;\n    });\n  }\n);\n\nexport const getCardsDataEncounterEntitiesBySetCode = createSelector(\n  getCardsDataEncounterEntities,\n  getCardsDataSetData,\n  (encounterEntities, setData): IEncounterEntity[] => {\n    const setTypesEncounters: { [key: string]: CardData[] } = {};\n\n    Object.values(encounterEntities).forEach((encounterCard) => {\n      const setCode = encounterCard.extraInfo.setCode || \"unknown\";\n      if (!!setTypesEncounters[setCode]) {\n        setTypesEncounters[setCode].push(encounterCard);\n      } else {\n        setTypesEncounters[setCode] = [encounterCard];\n      }\n    });\n\n    return Object.entries(setTypesEncounters)\n      .map(([key, value]) => ({\n        setCode: key,\n        setData: setData[key],\n        cards: value,\n      }))\n      .filter(\n        (set) =>\n          set.setData.setTypeCode !== \"nemesis\" &&\n          set.setData.setTypeCode !== \"hero\"\n      )\n      .sort((a, b) => (a.setData.name > b.setData.name ? 1 : -1));\n  }\n);\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"./initialState\";\n\nexport const getCards = (state: RootState) => state.liveState.present.cards;\n\nexport const getCardMapById = createSelector(getCards, (cards) => {\n  return cards.cards.reduce((map: { [k: string]: ICardStack }, card) => {\n    map[card.id] = card;\n    return map;\n  }, {});\n});\n\nexport const getPanMode = (state: RootState) =>\n  state.liveState.present.cards.panMode;\n\nexport const getDropTargetCardsById = createSelector(getCards, (cards) => {\n  const returnVal: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  } = {};\n  Object.entries(cards.dropTargetCards).forEach(([key, value]) => {\n    if (!!value) {\n      returnVal[value.id] = { ownerRef: key, card: value };\n    }\n  });\n\n  return returnVal;\n});\n","import { ICardDetails } from \"../features/cards/initialState\";\n\n// For some reason, the codes from marvelcdb and the images from cardgamedb can be off\nexport const CARD_PACK_REMAPPING: { [key: string]: string } = {\n  bkw: \"07\",\n  cap: \"04\",\n  drs: \"08\",\n  hlk: \"09\",\n  trors: \"10\",\n  twc: \"03\",\n};\n\n// export const EXTRA_CARDS: { [key: string]: { [key: string]: number } } = {\n//   doctor_strange: {\n//     \"09032\": 1,\n//     \"09033\": 1,\n//     \"09034\": 1,\n//     \"09035\": 1,\n//     \"09036\": 1,\n//   },\n//   ant: {\n//     \"12001c\": 1,\n//   },\n// };\n\nexport const EXTRA_CARDS: { [key: string]: ICardDetails[] } = {\n  doctor_strange: [\n    { jsonId: \"09032\" },\n    { jsonId: \"09033\" },\n    { jsonId: \"09034\" },\n    { jsonId: \"09035\" },\n    { jsonId: \"09036\" },\n  ],\n  ant: [{ jsonId: \"12001c\" }],\n  wsp: [{ jsonId: \"13001c\" }],\n};\n","import { GameType } from \"./app-constants\";\n\nexport interface GameProperties {\n  deckSite: string;\n  decklistApi: string;\n  encounterUiName: string;\n  tokens: {\n    stunned: TokenInfo | null;\n    confused: TokenInfo | null;\n    tough: TokenInfo | null;\n    damage: NumericTokenInfo | null;\n    threat: NumericTokenInfo | null;\n    generic: NumericTokenInfo | null;\n  };\n}\n\nexport interface NumericTokenInfo {\n  menuText: string;\n  imagePath: string;\n}\n\nexport interface TokenInfo {\n  menuText: string;\n  menuRemoveText: string;\n  imagePath: string;\n}\n\nexport const GamePropertiesMap: { [key in GameType]: GameProperties } = {\n  marvelchampions: {\n    deckSite: \"marvelcdb.com\",\n    decklistApi: \"https://marvelcdb.com/api/public/decklist/\",\n    encounterUiName: \"Encounter Set\",\n    tokens: {\n      stunned: {\n        menuText: \"Stun\",\n        menuRemoveText: \"Remove Stun\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/stunned.png\",\n      },\n      confused: {\n        menuText: \"Confuse\",\n        menuRemoveText: \"Remove Confuse\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/confused.png\",\n      },\n      tough: {\n        menuText: \"Tough\",\n        menuRemoveText: \"Remove Tough\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/tough.png\",\n      },\n      damage: {\n        menuText: \"Set Damage\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/damage.png\",\n      },\n      threat: {\n        menuText: \"Set Threat\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/threat.png\",\n      },\n      generic: {\n        menuText: \"Set Generic Tokens\",\n        imagePath:\n          process.env.PUBLIC_URL + \"/images/standard/generic_counter.png\",\n      },\n    },\n  },\n  lotrlcg: {\n    deckSite: \"ringsdb.com\",\n    decklistApi: \"https://ringsdb.com/api/public/decklist/\",\n    encounterUiName: \"Scenario\",\n    tokens: {\n      stunned: {\n        menuText: \"Quest\",\n        menuRemoveText: \"Remove From Quest\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/quest.png\",\n      },\n      confused: null,\n      tough: null,\n      damage: {\n        menuText: \"Set Damage\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/damage_lotr.png\",\n      },\n      threat: {\n        menuText: \"Set Progress\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/progress.png\",\n      },\n      generic: {\n        menuText: \"Set Resource Tokens\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/resource.png\",\n      },\n    },\n  },\n};\n","import { Action, createAsyncThunk, ThunkAction } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { Vector2d } from \"konva/types/types\";\nimport { RootState } from \"../../store/rootReducer\";\nimport {\n  getCardsDataEncounterEntities,\n  getCardsDataHeroEntities,\n} from \"../cards-data/cards-data.selectors\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  addCardStackWithId,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\nimport { ICardDetails, ICardStack } from \"./initialState\";\nimport { getCards } from \"./cards.selectors\";\nimport { EXTRA_CARDS } from \"../../constants/card-pack-mapping\";\nimport { GameType, myPeerRef } from \"../../constants/app-constants\";\nimport { GamePropertiesMap } from \"../../constants/game-type-properties-mapping\";\n\ninterface AddCardStackPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n}\n\nexport interface PullCardOutOfCardStackPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n}\n\nexport interface StartCardMovePayload {\n  id: string;\n  splitTopCard: boolean;\n}\n\nexport interface DrawCardsOutOfCardStackPayload {\n  cardStackId: string;\n  numberToDraw: number;\n}\n\nexport const shuffleStack = (\n  id?: string\n): ThunkAction<void, RootState, unknown, Action<string>> => (\n  dispatch,\n  getState\n) => {\n  const cardsState = getCards(getState());\n  const stacksToShuffle = !!id\n    ? [cardsState.cards.find((c) => c.id === id)]\n    : cardsState.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      );\n\n  stacksToShuffle\n    .filter((s): s is ICardStack => !!s && s.cardStack.length > 1)\n    .forEach((stackToShuffle) => {\n      dispatch(setStackShuffling({ id: stackToShuffle.id, shuffling: true }));\n      const shuffledStack = shuffle(stackToShuffle.cardStack);\n      dispatch(\n        replaceCardStack({ id: stackToShuffle.id, newStack: shuffledStack })\n      );\n\n      // We have to do a setTimeout here, because if we do it in this event loop,\n      // the overall change for this card is nothing for the shuffling param\n      setTimeout(() => {\n        dispatch(\n          setStackShuffling({ id: stackToShuffle.id, shuffling: false })\n        );\n      });\n    });\n};\n\nexport const addCardStack = (\n  payload: AddCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    id: uuidv4(),\n  };\n  dispatch(addCardStackWithId(payloadWithId));\n};\n\nexport const pullCardOutOfCardStack = (\n  payload: PullCardOutOfCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    id: uuidv4(),\n  };\n  dispatch(pullCardOutOfCardStackWithId(payloadWithId));\n};\n\nexport const startCardMove = (\n  payload: StartCardMovePayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    splitCardId: uuidv4(),\n  };\n  dispatch(startCardMoveWithSplitStackId(payloadWithId));\n};\n\nexport const drawCardsOutOfCardStack = (\n  payload: DrawCardsOutOfCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const possibleIds = Array.from({ length: payload.numberToDraw }).map((_i) =>\n    uuidv4()\n  );\n  const payloadWithIds = {\n    ...payload,\n    idsToUse: possibleIds,\n  };\n  dispatch(drawCardsOutOfCardStackWithIds(payloadWithIds));\n};\n\nexport const fetchDecklistById = createAsyncThunk(\n  \"decklist/fetchByIdStatus\",\n  async (\n    payload: { gameType: GameType; decklistId: number; position: Vector2d },\n    thunkApi\n  ) => {\n    const response = await axios.get(\n      `${GamePropertiesMap[payload.gameType].decklistApi}${payload.decklistId}`\n    );\n    const state: RootState = thunkApi.getState() as RootState;\n\n    switch (payload.gameType) {\n      case GameType.MarvelChampions:\n        return getMarvelCards(response, state, payload);\n      case GameType.LordOfTheRingsLivingCardGame:\n        return getLOTRCards(response, state, payload);\n    }\n  }\n);\n\nconst getMarvelCards = (\n  response: any,\n  state: RootState,\n  payload: { gameType: GameType; decklistId: number; position: Vector2d }\n) => {\n  const heroCardsData = getCardsDataHeroEntities(state);\n  const heroSet = heroCardsData[response.data.investigator_code];\n  const heroSetCode = heroSet.extraInfo.setCode;\n  const encounterCardsData = getCardsDataEncounterEntities(state);\n\n  const heroObligationDeck = Object.entries(encounterCardsData)\n    .filter(\n      ([_key, value]) =>\n        (value.extraInfo.setCode === `${heroSetCode}` ||\n          value.extraInfo.setCode === `${heroSetCode}_nemesis`) &&\n        value.typeCode === \"obligation\"\n    )\n    .map(([key, _value]) => key);\n\n  // get the encounter cards for this deck\n  const heroEncounterDeckData = Object.values(encounterCardsData).filter(\n    (value) =>\n      value.extraInfo.setCode === `${heroSetCode}_nemesis` &&\n      value.typeCode !== \"obligation\"\n  );\n\n  let heroEncounterDeck: string[] = [];\n  heroEncounterDeckData.forEach((cd) => {\n    heroEncounterDeck = heroEncounterDeck.concat(\n      Array.from({ length: cd.quantity }).map((_i) => cd.code)\n    );\n  });\n\n  // check to see if there are any special extra cards for this hero\n  const extraCards = EXTRA_CARDS[heroSetCode ?? \"\"] ?? [];\n\n  // response.data.slots = { ...extraCards, ...response.data.slots };\n\n  return {\n    position: payload.position,\n    heroId: uuidv4(),\n    data: response.data,\n    dataId: uuidv4(),\n    extraHeroCards: extraCards,\n    relatedEncounterDeck: heroEncounterDeck,\n    encounterDeckId: uuidv4(),\n    relatedObligationDeck: heroObligationDeck,\n    obligationDeckId: uuidv4(),\n  };\n};\n\nconst getLOTRCards = (\n  response: any,\n  state: RootState,\n  payload: { gameType: GameType; decklistId: number; position: Vector2d }\n) => {\n  const heroCardsData = getCardsDataHeroEntities(state);\n\n  let heroStack: ICardDetails[] = [];\n\n  Object.entries(response.data.heroes).forEach(([key, value]) => {\n    const cardDetails: ICardDetails[] = Array.from(Array(value).keys()).map(\n      (): ICardDetails => ({ jsonId: key })\n    );\n    heroStack = heroStack.concat(cardDetails);\n  });\n\n  const newSlots: { [key: string]: number } = {};\n\n  Object.entries(response.data.slots).forEach(([key, value]) => {\n    //get the card data to make sure it's not a hero\n    const cardData = heroCardsData[key];\n    if (!cardData) {\n      throw new Error(`Couldn't find card data for ${key}`);\n    }\n\n    if (cardData.typeCode !== \"Hero\") {\n      newSlots[key] = value as number;\n    }\n  });\n\n  response.data.slots = newSlots;\n\n  return {\n    position: payload.position,\n    heroId: uuidv4(),\n    data: response.data,\n    dataId: uuidv4(),\n    extraHeroCards: heroStack,\n    relatedEncounterDeck: [],\n    encounterDeckId: uuidv4(),\n    relatedObligationDeck: [],\n    obligationDeckId: uuidv4(),\n  };\n};\n\nconst shuffle = (array: ICardDetails[]): ICardDetails[] => {\n  const returnArray = JSON.parse(JSON.stringify(array));\n  var currentIndex = returnArray.length,\n    temporaryValue,\n    randomIndex;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = returnArray[currentIndex];\n    returnArray[currentIndex] = returnArray[randomIndex];\n    returnArray[randomIndex] = temporaryValue;\n  }\n\n  return returnArray;\n};\n","export const cardConstants = {\n  CARD_HEIGHT: 209,\n  CARD_WIDTH: 150,\n  CARD_PREVIEW_HEIGHT: 418,\n  CARD_PREVIEW_WIDTH: 300,\n};\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\n\nexport interface AddNewCounterWithIdPayload {\n  pos: Vector2d;\n  id: string;\n}\n\nexport const addNewCounterWithId = createAction<AddNewCounterWithIdPayload>(\n  \"addNewCounterWithId\"\n);\n","import { Vector2d } from \"konva/types/types\";\nimport { PlayerColor } from \"../../constants/app-constants\";\nimport { loadState } from \"../../store/localStorage\";\n\nexport interface ICountersState {\n  counters: ICounter[];\n  firstPlayerCounterPosition: Vector2d;\n}\n\nexport interface ICounter {\n  id: string;\n  position: Vector2d;\n  value: number;\n  color: PlayerColor;\n}\n\nconst localStorageState: ICountersState =\n  loadState(\"liveState\")?.counters ?? {};\n\nconst defaultState: ICountersState = {\n  counters: [],\n  firstPlayerCounterPosition: { x: 0, y: 0 },\n};\nexport const initialState: ICountersState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { PlayerColor } from \"../../constants/app-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport { addNewCounterWithId } from \"./counters.actions\";\nimport { ICountersState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateCounterValueReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; delta: number }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.value += action.payload.delta;\n    if (counter.value < 0) {\n      counter.value = 0;\n    }\n  }\n};\n\nconst updateCounterColorReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; newColor: PlayerColor }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.color = action.payload.newColor;\n  }\n};\n\nconst removeCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<string>\n> = (state, action) => {\n  state.counters = state.counters.filter((c) => c.id !== action.payload);\n};\n\nconst moveCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; newPos: Vector2d }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.position = {\n      x: action.payload.newPos.x,\n      y: action.payload.newPos.y,\n    };\n  }\n};\n\nconst moveFirstPlayerCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.firstPlayerCounterPosition = {\n    x: action.payload.x,\n    y: action.payload.y,\n  };\n};\n\n// slice\nconst countersSlice = createSlice({\n  name: \"counters\",\n  initialState: initialState,\n  reducers: {\n    updateCounterValue: updateCounterValueReducer,\n    removeCounter: removeCounterReducer,\n    moveCounter: moveCounterReducer,\n    moveFirstPlayerCounter: moveFirstPlayerCounterReducer,\n    updateCounterColor: updateCounterColorReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.counters = action.payload.liveState.present.counters.counters;\n      state.firstPlayerCounterPosition =\n        action.payload.liveState.present.counters.firstPlayerCounterPosition;\n    });\n\n    builder.addCase(resetApp, (state, action) => {\n      state.counters = [];\n      state.firstPlayerCounterPosition = { x: 0, y: 0 };\n    });\n\n    builder.addCase(addNewCounterWithId, (state, action) => {\n      state.counters.push({\n        id: action.payload.id,\n        position: action.payload.pos,\n        value: 0,\n        color: \"red\",\n      });\n    });\n  },\n});\n\nexport const {\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  moveFirstPlayerCounter,\n  updateCounterColor,\n} = countersSlice.actions;\n\nexport default countersSlice.reducer;\n","import { combineReducers } from \"redux\";\nimport undoable, { excludeAction, groupByActionTypes } from \"redux-undo\";\nimport cardsData from \"../features/cards-data/cards-data.slice\";\nimport { startCardMoveWithSplitStackId } from \"../features/cards/cards.actions\";\nimport cards, { cardMove } from \"../features/cards/cards.slice\";\nimport game, {\n  clearPreviewCard,\n  setPreviewCardId,\n} from \"../features/game/game.slice\";\n\nimport counters, { moveCounter } from \"../features/counters/counters.slice\";\n\nconst undoableState = combineReducers({\n  counters,\n  cards,\n});\n\nconst rootReducer = combineReducers({\n  game,\n  cardsData,\n  liveState: undoable(undoableState, {\n    limit: 20,\n    groupBy: groupByActionTypes([moveCounter.type]),\n    filter: excludeAction([\n      startCardMoveWithSplitStackId.type,\n      cardMove.type,\n      setPreviewCardId.type,\n      clearPreviewCard.type,\n    ]),\n  }),\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import Peer from \"peerjs\";\nimport { myPeerRef } from \"../constants/app-constants\";\nimport { togglePanMode } from \"../features/cards/cards.slice\";\nimport {\n  loadCardsData,\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} from \"../features/cards-data/cards-data.slice\";\nimport {\n  clearMenuPreviewCardJsonId,\n  clearPreviewCard,\n  connectToRemoteGame,\n  requestResync,\n  setMenuPreviewCardJsonId,\n  setPeerId,\n  setPlayerColor,\n  setPreviewCardId,\n  updatePosition,\n  updateZoom,\n} from \"../features/game/game.slice\";\nimport { receiveRemoteGameState } from \"./global.actions\";\n\nconst DEBUG = false;\n\nconst blacklistRemoteActions = {\n  [connectToRemoteGame.type]: true,\n  [updatePosition.type]: true,\n  [updateZoom.type]: true,\n  [setPreviewCardId.type]: true,\n  [clearPreviewCard.type]: true,\n  [setMenuPreviewCardJsonId.type]: true,\n  [clearMenuPreviewCardJsonId.type]: true,\n  [togglePanMode.type]: true,\n  [receiveRemoteGameState.type]: true,\n  [requestResync.type]: true,\n  [loadCardsData.type]: true,\n  [loadCardsDataForPack.type]: true,\n  [loadCardsForEncounterSet.type]: true,\n};\n\nconst log = (...args: any[]) => {\n  if (DEBUG) {\n    console.log(args[0], args[1]);\n  }\n};\n\nconst setupConnection = (conn: any, storeAPI: any) => {\n  conn.on(\"data\", (data: any) => {\n    if (!data.INITIAL_STATE_MSG) {\n      if (!!data.RESYNC) {\n        log(\"received request for resync\");\n        conn.send({\n          INITIAL_STATE_MSG: true,\n          state: storeAPI.getState(),\n        });\n      } else {\n        log(\"recieved remote action\", data);\n        data.REMOTE_ACTION = true;\n        log(\"dispatching remote action\", data);\n        storeAPI.dispatch(data);\n      }\n    } else {\n      console.log(\"going to replace (most of) state with\", data.state);\n      setTimeout(() => {\n        storeAPI.dispatch(receiveRemoteGameState(data.state));\n      }, 0);\n    }\n  });\n};\n\nexport const peerJSMiddleware = (storeAPI: any) => {\n  const cgpPeer = new Peer(undefined, {\n    debug: 0,\n    config: {\n      iceServers: [\n        { urls: \"stun:stun.l.google.com:19302\" },\n        {\n          urls: \"turn:numb.viagenie.ca\",\n          username: \"webrtc@live.com\",\n          credential: \"muazkh\",\n        },\n      ],\n    },\n  });\n  let activeCon: Peer.DataConnection;\n\n  cgpPeer.on(\"error\", (err) => {\n    console.error(\"*****************Server error\");\n    console.error(err);\n  });\n\n  cgpPeer.on(\"disconnected\", () => {\n    console.log(\"****Peer server connection disconnected\");\n  });\n\n  cgpPeer.on(\"open\", (id) => {\n    console.log(\"My peer ID is: \" + id);\n    storeAPI.dispatch(setPeerId(id));\n\n    //look for query param\n    const remoteParamArray = window.location.href.split(\"remote=\");\n    if (remoteParamArray.length > 1) {\n      const remoteId = remoteParamArray[1].split(\"&\")[0];\n      console.log(\"FOUND QUERY PARAM. Going to connect to peer \" + remoteId);\n      activeCon = cgpPeer.connect(remoteId, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    }\n  });\n\n  cgpPeer.on(\"connection\", (conn) => {\n    console.log(\"Connection received!\");\n    activeCon = conn;\n    setupConnection(activeCon, storeAPI);\n\n    activeCon.on(\"open\", () => {\n      console.log(\"connection ready for data\");\n      log(\"going to send initial state\", storeAPI.getState());\n      activeCon.send({\n        INITIAL_STATE_MSG: true,\n        state: storeAPI.getState(),\n      });\n      // TODO: more complicated logic to handle multiple connections. Right now\n      // this just changes the connecting client to blue\n      const setPlayerColorAction = setPlayerColor({\n        ref: activeCon.metadata.ref,\n        color: \"blue\",\n      });\n      activeCon.send(setPlayerColorAction);\n      activeCon.send(\n        setPlayerColor({\n          ref: myPeerRef,\n          color: \"red\",\n        })\n      );\n      storeAPI.dispatch(setPlayerColorAction);\n    });\n\n    activeCon.on(\"error\", (err) => {\n      console.error(\"****************Connection error:\", err);\n    });\n\n    activeCon.on(\"close\", () => {\n      console.log(\"******connection closed for ref \" + activeCon.metadata.ref);\n    });\n\n    activeCon.peerConnection.onconnectionstatechange = (ev: Event) => {\n      console.log(`connection state changed`);\n      console.log(ev);\n      console.log(activeCon.peerConnection.connectionState);\n      if (\n        activeCon.peerConnection.connectionState === \"closed\" ||\n        activeCon.peerConnection.connectionState === \"disconnected\"\n      ) {\n        console.log(\n          \"CLEARING CLIENT OWNED CARDS for \" + activeCon.metadata.ref\n        );\n      }\n    };\n  });\n  return (next: any) => (action: any) => {\n    log(\"received local action\", action);\n\n    // If this isn't a REMOTE action, add our ref onto it\n    if (!action.REMOTE_ACTION) {\n      action.ACTOR_REF = myPeerRef;\n    } else if (!action.ACTOR_REF) {\n      console.error(`Received a REMOTE action without an ACTOR_REF:`);\n      console.log(action);\n    }\n\n    if (action.type === connectToRemoteGame.type) {\n      console.log(\"going to connect to peer \" + action.payload);\n      activeCon = cgpPeer.connect(action.payload, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    } else if (action.type === requestResync.type) {\n      if (!!activeCon) {\n        activeCon.send({ RESYNC: true });\n      }\n    }\n\n    if (\n      !action.REMOTE_ACTION &&\n      !!activeCon &&\n      !blacklistRemoteActions[action.type]\n    ) {\n      log(\"going to send action to peer!\");\n      activeCon.send(action);\n    }\n\n    return next(action);\n  };\n};\n","import throttle from \"lodash.throttle\";\nimport {\n  configureStore as rtkConfigureStore,\n  getDefaultMiddleware,\n} from \"@reduxjs/toolkit\";\nimport rootReducer from \"./rootReducer\";\nimport { saveState } from \"./localStorage\";\nimport { peerJSMiddleware } from \"./peer-js-redux-middleware\";\n\nconst customizedMiddleware = getDefaultMiddleware({\n  thunk: true,\n  immutableCheck: false,\n  serializableCheck: false,\n}).concat(peerJSMiddleware);\n\nexport default function configureStore() {\n  console.log(\"configuring store. NODE_ENV is \" + process.env.NODE_ENV);\n  const store = rtkConfigureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware,\n    devTools: process.env.NODE_ENV !== \"production\",\n  });\n\n  store.subscribe(\n    throttle(() => {\n      saveState(store.getState());\n    }, 1000)\n  );\n\n  return store;\n}\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { Rect, Text } from \"react-konva\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport { GameType } from \"./constants/app-constants\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\ninterface IProps {\n  currentGameType: GameType;\n  x: number;\n  y: number;\n  card: ICardStack | undefined;\n}\n\ninterface IState {\n  imagesLoaded: {\n    damage: boolean;\n    threat: boolean;\n    generic: boolean;\n  };\n}\n\nconst desiredWidth = 47;\nconst desiredHeight = 47;\n\nclass CardTokens extends Component<IProps, IState> {\n  private damageImg: HTMLImageElement;\n  private threatImg: HTMLImageElement;\n  private genericImg: HTMLImageElement;\n  private unmounted: boolean;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imagesLoaded: {\n        damage: false,\n        threat: false,\n        generic: false,\n      },\n    };\n\n    this.damageImg = new Image();\n    this.threatImg = new Image();\n    this.genericImg = new Image();\n\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // DAMAGE\n    this.damageImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: true,\n            threat: this.state.imagesLoaded.threat,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.damage && !!tokenInfo.damage) {\n      this.damageImg.src = tokenInfo.damage.imagePath;\n    }\n\n    // THREAT\n    this.threatImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: true,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.threat && !!tokenInfo.threat) {\n      this.threatImg.src = tokenInfo.threat.imagePath;\n    }\n\n    // GENERIC\n    this.genericImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: this.state.imagesLoaded.threat,\n            generic: true,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.generic && !!tokenInfo.generic) {\n      this.genericImg.src = tokenInfo.generic.imagePath;\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // DAMAGE\n    if (\n      !this.state.imagesLoaded.damage &&\n      !prevProps.card?.counterTokens.damage &&\n      !!this.props.card?.counterTokens.damage &&\n      !!tokenInfo.damage\n    ) {\n      this.damageImg.src = tokenInfo.damage.imagePath;\n    }\n\n    // THREAT\n    if (\n      !this.state.imagesLoaded.threat &&\n      !prevProps.card?.counterTokens.threat &&\n      !!this.props.card?.counterTokens.threat &&\n      !!tokenInfo.threat\n    ) {\n      this.threatImg.src = tokenInfo.threat.imagePath;\n    }\n\n    // GENERIC\n    if (\n      !this.state.imagesLoaded.generic &&\n      !prevProps.card?.counterTokens.generic &&\n      !!this.props.card?.counterTokens.generic &&\n      !!tokenInfo.generic\n    ) {\n      this.genericImg.src = tokenInfo.generic.imagePath;\n    }\n  }\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  render() {\n    if (!this.props.card) return null;\n\n    const damageX = this.props.x - desiredWidth / 2;\n    const damageY = this.props.y - cardConstants.CARD_HEIGHT / 2 + 20;\n    const showDamage =\n      this.state.imagesLoaded.damage && !!this.props.card.counterTokens.damage;\n\n    const damageToken = showDamage ? (\n      <Rect\n        key={`${this.props.card.id}-damageToken`}\n        x={damageX}\n        y={damageY}\n        scale={{\n          x: desiredWidth / this.damageImg.naturalWidth,\n          y: desiredHeight / this.damageImg.naturalHeight,\n        }}\n        width={this.damageImg.naturalWidth}\n        height={this.damageImg.naturalHeight}\n        fillPatternImage={this.damageImg}\n      ></Rect>\n    ) : null;\n\n    const damageText = showDamage ? (\n      <Text\n        key={`${this.props.card.id}-damageText`}\n        x={damageX}\n        y={damageY}\n        width={\n          this.damageImg.naturalWidth *\n          (desiredWidth / this.damageImg.naturalWidth)\n        }\n        height={\n          this.damageImg.naturalHeight *\n          (desiredHeight / this.damageImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.damage}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const threatX = this.props.x - desiredWidth / 2;\n    const threatY = damageY + desiredHeight + 5;\n    const showThreat =\n      this.state.imagesLoaded.threat && !!this.props.card.counterTokens.threat;\n\n    const threatToken = showThreat ? (\n      <Rect\n        key={`${this.props.card.id}-threatToken`}\n        x={threatX}\n        y={threatY}\n        scale={{\n          x: desiredWidth / this.threatImg.naturalWidth,\n          y: desiredHeight / this.threatImg.naturalHeight,\n        }}\n        width={this.threatImg.naturalWidth}\n        height={this.threatImg.naturalHeight}\n        fillPatternImage={this.threatImg}\n      ></Rect>\n    ) : null;\n\n    const threatText = showThreat ? (\n      <Text\n        key={`${this.props.card.id}-threatText`}\n        x={threatX}\n        y={threatY}\n        width={\n          this.threatImg.naturalWidth *\n          (desiredWidth / this.threatImg.naturalWidth)\n        }\n        height={\n          this.threatImg.naturalHeight *\n          (desiredHeight / this.threatImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.threat}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const genericX = this.props.x - desiredWidth / 2;\n    const genericY = threatY + desiredHeight + 5;\n    const showGeneric =\n      this.state.imagesLoaded.generic &&\n      !!this.props.card.counterTokens.generic;\n\n    const genericToken = showGeneric ? (\n      <Rect\n        key={`${this.props.card.id}-genericToken`}\n        x={genericX}\n        y={genericY}\n        scale={{\n          x: desiredWidth / this.genericImg.naturalWidth,\n          y: desiredHeight / this.genericImg.naturalHeight,\n        }}\n        width={this.genericImg.naturalWidth}\n        height={this.genericImg.naturalHeight}\n        fillPatternImage={this.genericImg}\n      ></Rect>\n    ) : null;\n\n    const genericText = showGeneric ? (\n      <Text\n        key={`${this.props.card.id}-genericText`}\n        x={genericX}\n        y={genericY}\n        width={\n          this.genericImg.naturalWidth *\n          (desiredWidth / this.genericImg.naturalWidth)\n        }\n        height={\n          this.genericImg.naturalHeight *\n          (desiredHeight / this.genericImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.generic}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    return [\n      damageToken,\n      damageText,\n      threatToken,\n      threatText,\n      genericToken,\n      genericText,\n    ];\n  }\n}\n\nexport default CardTokens;\n","import { connect } from \"react-redux\";\n\nimport { RootState } from \"./store/rootReducer\";\nimport CardTokens from \"./CardTokens\";\nimport { getCardMapById } from \"./features/cards/cards.selectors\";\n\nexport interface IProps {\n  id: string;\n}\n\nconst mapStateToProps = (state: RootState, props: IProps) => {\n  return {\n    card: getCardMapById(state)[props.id],\n  };\n};\n\nconst CardTokensContainer = connect(mapStateToProps, {})(CardTokens);\n\nexport default CardTokensContainer;\n","// tslint:disable:no-console\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { Rect as RectRef } from \"konva/types/shapes/Rect\";\nimport { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Rect, Text } from \"react-konva\";\nimport { animated, Spring } from \"react-spring/renderprops-konva\";\nimport CardTokensContainer from \"./CardTokensContainer\";\nimport { GameType, myPeerRef, PlayerColor } from \"./constants/app-constants\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\n\nexport const HORIZONTAL_TYPE_CODES = [\n  \"main_scheme\",\n  \"side_scheme\",\n  \"quest\",\n  \"player_side_quest\",\n];\n\nexport interface CardTokens {\n  damage: number;\n  threat: number;\n  generic: number;\n}\n\nexport interface CardUIState {\n  stunned: boolean;\n  confused: boolean;\n  tough: boolean;\n  tokens: CardTokens;\n}\n\ninterface IProps {\n  currentGameType: GameType;\n  name: string;\n  code: string;\n  selectedColor: PlayerColor;\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  cardState?: CardUIState;\n  fill: string;\n  handleClick?: (id: string, event: KonvaEventObject<MouseEvent>) => void;\n  handleDoubleClick?: (id: string, event: KonvaEventObject<MouseEvent>) => void;\n  handleDragStart?: (id: string, event: KonvaEventObject<DragEvent>) => void;\n  handleDragMove?: (info: { id: string; dx: number; dy: number }) => void;\n  handleDragEnd?: (id: string) => void;\n  handleHover?: (id: string) => void;\n  handleHoverLeave?: (id: string) => void;\n  id: string;\n  selected: boolean;\n  dropTargetColor?: string;\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  imgUrls: string[];\n  isGhost?: boolean;\n  numCardsInStack?: number;\n  typeCode?: string;\n  faceup: boolean;\n  handleContextMenu?: (\n    id: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => void;\n}\n\ninterface IState {\n  imageLoaded: boolean;\n  imageLoadFailed: number;\n  prevImgUrls: string[];\n  tokenImagesLoaded: {\n    stunned: boolean;\n    confused: boolean;\n    tough: boolean;\n  };\n}\n\nconst stringArraysEqual = (array1: string[], array2: string[]) => {\n  return (\n    array1.length === array2.length &&\n    array1.every((value, index) => {\n      return value === array2[index];\n    })\n  );\n};\n\nclass Card extends Component<IProps, IState> {\n  // tslint:disable-next-line:member-access\n  static getDerivedStateFromProps(props: IProps, state: IState): IState | null {\n    if (!stringArraysEqual(props.imgUrls, state.prevImgUrls ?? [])) {\n      return {\n        imageLoaded: false,\n        imageLoadFailed: 0,\n        prevImgUrls: props.imgUrls,\n        tokenImagesLoaded: {\n          stunned: state.tokenImagesLoaded.stunned,\n          confused: state.tokenImagesLoaded.confused,\n          tough: state.tokenImagesLoaded.tough,\n        },\n      };\n    }\n    // No state update necessary\n    return null;\n  }\n\n  private imgs: HTMLImageElement[] = [];\n  private stunnedImg: HTMLImageElement;\n  private confusedImg: HTMLImageElement;\n  private toughImg: HTMLImageElement;\n  private unmounted: boolean;\n  private touchTimer: any = null;\n  private rect: RectRef | null = null;\n  private shuffleToggle = false;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imageLoaded: false,\n      imageLoadFailed: 0,\n      prevImgUrls: this.props.imgUrls,\n      tokenImagesLoaded: {\n        stunned: false,\n        confused: false,\n        tough: false,\n      },\n    };\n\n    this.initCardImages(props);\n\n    this.stunnedImg = new Image();\n    this.confusedImg = new Image();\n    this.toughImg = new Image();\n\n    // STUNNED\n    this.stunnedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: true,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    const tokenInfo = GamePropertiesMap[props.currentGameType].tokens;\n\n    if (!!props.cardState?.stunned && !!tokenInfo.stunned) {\n      this.stunnedImg.src = tokenInfo.stunned.imagePath;\n    }\n\n    // CONFUSED\n    this.confusedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: true,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.confused && !!tokenInfo.confused) {\n      this.confusedImg.src = tokenInfo.confused.imagePath;\n    }\n\n    // TOUGH\n    this.toughImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: true,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.tough && !!tokenInfo.tough) {\n      this.toughImg.src = tokenInfo.tough.imagePath;\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    // if we just went from not shuffling -> shuffling, animate\n    if (!prevProps.shuffling && this.props.shuffling) {\n      if (!!this.rect) {\n        this.shuffleToggle = !this.shuffleToggle;\n        this.rect.to({\n          rotation: this.currentRotation + (this.shuffleToggle ? 360 : -360),\n          duration: 0.2,\n        });\n      }\n    }\n\n    if (\n      !this.state.imageLoaded &&\n      !stringArraysEqual(prevProps.imgUrls, this.props.imgUrls)\n    ) {\n      this.setState({\n        imageLoaded: false,\n        imageLoadFailed: 0,\n      });\n      this.initCardImages(this.props);\n    }\n\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // STUNNED\n    if (\n      !this.state.tokenImagesLoaded.stunned &&\n      !prevProps.cardState?.stunned &&\n      !!this.props.cardState?.stunned &&\n      !!tokenInfo.stunned\n    ) {\n      this.stunnedImg.src = tokenInfo.stunned.imagePath;\n    }\n\n    // CONFUSED\n    if (\n      !this.state.tokenImagesLoaded.confused &&\n      !prevProps.cardState?.confused &&\n      !!this.props.cardState?.confused &&\n      !!tokenInfo.confused\n    ) {\n      this.confusedImg.src = tokenInfo.confused.imagePath;\n    }\n\n    // TOUGH\n    if (\n      !this.state.tokenImagesLoaded.tough &&\n      !prevProps.cardState?.tough &&\n      !!this.props.cardState?.tough &&\n      !!tokenInfo.tough\n    ) {\n      this.toughImg.src = tokenInfo.tough.imagePath;\n    }\n  }\n\n  private initCardImages = (props: IProps) => {\n    this.imgs = props.imgUrls.map(() => new Image());\n\n    // When the image loads, set a flag in the state\n    this.imgs.forEach(\n      (img) =>\n        (img.onload = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoaded: true,\n            });\n          }\n        })\n    );\n\n    this.imgs.forEach(\n      (img) =>\n        (img.onerror = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoadFailed: this.state.imageLoadFailed + 1,\n            });\n          }\n        })\n    );\n\n    props.imgUrls.forEach((imgUrl, index) => (this.imgs[index].src = imgUrl));\n  };\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  public render() {\n    return this.renderCard(this.state.imageLoaded);\n  }\n\n  private renderCard(imageLoaded: boolean) {\n    const heightToUse = this.props.height || cardConstants.CARD_HEIGHT;\n    const widthToUse = this.props.width || cardConstants.CARD_WIDTH;\n\n    return this.renderUnanimatedCard(heightToUse, widthToUse, imageLoaded);\n  }\n\n  // Unfortunately, if you try to use shadow / blur to indicate selection\n  // (which I did at first and looks better, imo) the performance in horrible,\n  // even with some reccommended settings (shadowForStrokeEnabled = false and\n  // hitStrokeWidth = 0). So we'll just use stroke / border for everything\n  private getStrokeColor = () => {\n    if (!!this.props.dropTargetColor) {\n      return this.props.dropTargetColor;\n    }\n\n    if (this.props.selected) {\n      return this.props.selectedColor;\n    }\n\n    return \"\";\n  };\n\n  private renderUnanimatedCard = (\n    heightToUse: number,\n    widthToUse: number,\n    imageLoaded: boolean\n  ) => {\n    const imgToUse = imageLoaded\n      ? this.imgs.find((i) => i.complete && i.naturalHeight !== 0)\n      : undefined;\n\n    const scale = this.getScale(imgToUse, widthToUse, heightToUse);\n    const offset = {\n      x: widthToUse / 2,\n      y: heightToUse / 2,\n    };\n\n    const card = (\n      <Spring\n        key={`${this.props.id}-card`}\n        native={true}\n        to={{\n          rotation: this.props.exhausted ? 90 : 0,\n        }}\n      >\n        {(animatedProps: any) => (\n          <animated.Rect\n            {...animatedProps}\n            ref={(node) => {\n              if (!!node) {\n                this.rect = node;\n              }\n            }}\n            cornerRadius={9}\n            x={this.props.x}\n            y={this.props.y}\n            width={widthToUse}\n            height={heightToUse}\n            offset={offset}\n            stroke={this.getStrokeColor()}\n            strokeWidth={!!this.getStrokeColor() ? 4 : 0}\n            fillPatternRotation={\n              !imageLoaded ||\n              this.shouldRenderImageHorizontal(\n                this.props.typeCode || \"\",\n                HORIZONTAL_TYPE_CODES\n              )\n                ? 270\n                : 0\n            }\n            fillPatternImage={imgToUse}\n            fillPatternScaleX={scale.width}\n            fillPatternScaleY={scale.height}\n            fill={imageLoaded ? undefined : \"gray\"}\n            shadowForStrokeEnabled={false}\n            hitStrokeWidth={0}\n            opacity={this.props.isGhost ? 0.5 : 1}\n            draggable={\n              this.props.controlledBy === \"\" ||\n              this.props.controlledBy === myPeerRef\n            }\n            onDragStart={this.handleDragStart}\n            onDragMove={this.handleDragMove}\n            onDragEnd={this.handleDragEnd}\n            onDblClick={this.handleDoubleClick}\n            onDblTap={this.handleDoubleClick}\n            onClick={this.handleClick}\n            onTap={this.handleClick}\n            onMouseDown={this.handleMouseDown}\n            onTouchStart={this.handleTouchStart}\n            onTouchMove={this.handleTouchMove}\n            onTouchEnd={this.handleTouchEnd}\n            onMouseOver={this.handleMouseOver}\n            onMouseOut={this.handleMouseOut}\n            onContextMenu={this.handleContextMenu}\n          />\n        )}\n      </Spring>\n    );\n\n    const cardStackOffset = {\n      x: offset.x + 4,\n      y: offset.y - 4,\n    };\n\n    const cardStack =\n      (this.props.numCardsInStack || 1) > 1 ? (\n        <Spring\n          key={`${this.props.id}-cardStack`}\n          native={true}\n          to={{\n            rotation: this.props.exhausted ? 90 : 0,\n          }}\n        >\n          {(animatedProps: any) => (\n            <animated.Rect\n              {...animatedProps}\n              cornerRadius={[9, 9, 9, 9]}\n              x={this.props.x}\n              y={this.props.y}\n              width={widthToUse}\n              height={heightToUse}\n              offset={cardStackOffset}\n              opacity={this.props.isGhost ? 0.5 : 1}\n              fill={\"gray\"}\n              shadowForStrokeEnabled={false}\n              hitStrokeWidth={0}\n            />\n          )}\n        </Spring>\n      ) : null;\n\n    const shouldRenderStunned =\n      !!this.props.cardState?.stunned && this.state.tokenImagesLoaded.stunned;\n\n    const stunnedToken = this.getTokenInSlot(\n      shouldRenderStunned,\n      this.stunnedImg,\n      offset,\n      0\n    );\n    const confusedToken = this.getTokenInSlot(\n      !!this.props.cardState?.confused && this.state.tokenImagesLoaded.confused,\n      this.confusedImg,\n      offset,\n      1\n    );\n    const toughToken = this.getTokenInSlot(\n      !!this.props.cardState?.tough && this.state.tokenImagesLoaded.tough,\n      this.toughImg,\n      offset,\n      2\n    );\n\n    const cardTokens =\n      this.props.dragging || this.props.isGhost ? null : (\n        <CardTokensContainer\n          currentGameType={this.props.currentGameType}\n          key={`${this.props.id}-cardTokens`}\n          id={this.props.id}\n          x={this.props.x}\n          y={this.props.y}\n        ></CardTokensContainer>\n      );\n\n    const noImageCardNameText = this.renderCardName(\n      offset,\n      widthToUse,\n      heightToUse\n    );\n\n    return [\n      cardStack,\n      card,\n      noImageCardNameText,\n      stunnedToken,\n      confusedToken,\n      toughToken,\n      cardTokens,\n    ];\n  };\n\n  private renderCardName(\n    offset: Vector2d,\n    cardWidth: number,\n    cardHeight: number\n  ) {\n    const textOffset = { x: offset.x - 10, y: offset.y - 20 };\n    const textItem =\n      this.state.imageLoadFailed === this.props.imgUrls.length &&\n      this.state.imageLoadFailed !== 0 ? (\n        <Text\n          key={`${this.props.id}-cardnametext`}\n          offset={textOffset}\n          x={this.props.x}\n          y={this.props.y}\n          width={cardWidth - 10}\n          height={cardHeight - 20}\n          fontSize={24}\n          text={`${this.props.name} ${this.props.code}`}\n          draggable={\n            this.props.controlledBy === \"\" ||\n            this.props.controlledBy === myPeerRef\n          }\n          onDragStart={this.handleDragStart}\n          onDragMove={this.handleDragMove}\n          onDragEnd={this.handleDragEnd}\n          onDblClick={this.handleDoubleClick}\n          onDblTap={this.handleDoubleClick}\n          onClick={this.handleClick}\n          onTap={this.handleClick}\n          onMouseDown={this.handleMouseDown}\n          onTouchStart={this.handleMouseDown}\n          onMouseOver={this.handleMouseOver}\n          onMouseOut={this.handleMouseOut}\n          onContextMenu={this.handleContextMenu}\n        ></Text>\n      ) : null;\n\n    return textItem;\n  }\n\n  private getTokenInSlot(\n    shouldRender: boolean,\n    img: HTMLImageElement,\n    offset: { x: number; y: number },\n    slot: 0 | 1 | 2\n  ) {\n    const dimensions = {\n      width: img.naturalWidth / 2,\n      height: img.naturalHeight / 2,\n    };\n\n    const stunnedOffset = {\n      x: offset.x - cardConstants.CARD_WIDTH + dimensions.width / 2,\n      y: offset.y - dimensions.height * slot - 5 * (slot + 1) - 10,\n    };\n\n    return shouldRender ? (\n      <Rect\n        key={`${this.props.id}-status${slot}`}\n        native={true}\n        cornerRadius={8}\n        x={this.props.x}\n        y={this.props.y}\n        width={dimensions.width}\n        height={dimensions.height}\n        fillPatternScaleX={0.5}\n        fillPatternScaleY={0.5}\n        offset={stunnedOffset}\n        fillPatternImage={img}\n      />\n    ) : null;\n  }\n\n  private shouldRenderImageHorizontal(\n    type: string,\n    typeCodes: string[]\n  ): boolean {\n    return typeCodes.includes(type.toLocaleLowerCase()) && !this.plainCardBack;\n  }\n\n  private get plainCardBack() {\n    return (\n      this.props.imgUrls.some((i) => i.includes(\"standard\")) &&\n      this.props.imgUrls.some((i) => i.includes(\"_back\"))\n    );\n  }\n\n  private get currentRotation() {\n    return this.props.exhausted ? 90 : 0;\n  }\n\n  private getScale(\n    img: HTMLImageElement | undefined,\n    widthToUse: number,\n    heightToUse: number\n  ) {\n    const width = !!img ? widthToUse / img.naturalWidth : widthToUse;\n\n    const widthHorizontal = !!img ? heightToUse / img.naturalWidth : widthToUse;\n\n    const height = !!img ? heightToUse / img.naturalHeight : heightToUse;\n\n    const heightHorizontal = !!img\n      ? widthToUse / img.naturalHeight\n      : heightToUse;\n\n    return this.shouldRenderImageHorizontal(\n      this.props.typeCode || \"\",\n      HORIZONTAL_TYPE_CODES\n    )\n      ? { width: widthHorizontal, height: heightHorizontal }\n      : { width, height };\n  }\n\n  private handleContextMenu = (event: KonvaEventObject<PointerEvent>): void => {\n    if (!!this.props.handleContextMenu) {\n      this.props.handleContextMenu(this.props.id, event);\n    }\n  };\n\n  private handleDoubleClick = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.props.handleDoubleClick) {\n      this.props.handleDoubleClick(this.props.id, event);\n    }\n  };\n\n  private handleDragStart = (event: KonvaEventObject<DragEvent>) => {\n    if (this.props.handleDragStart) {\n      this.props.handleDragStart(this.props.id, event);\n    }\n  };\n\n  private handleDragMove = (event: any) => {\n    if (this.props.handleDragMove) {\n      this.props.handleDragMove({\n        id: this.props.id,\n        dx: event.target.x() - this.props.x,\n        dy: event.target.y() - this.props.y,\n      });\n    }\n  };\n\n  private handleDragEnd = () => {\n    if (this.props.handleDragEnd && this.props.dragging) {\n      this.props.handleDragEnd(this.props.id);\n    }\n  };\n\n  private handleClick = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.props.handleClick) {\n      this.props.handleClick(this.props.id, event);\n      event.cancelBubble = true;\n    }\n  };\n\n  private handleMouseDown = (event: any) => {\n    event.cancelBubble = true;\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(\n        (event as unknown) as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleMouseOver = () => {\n    if (this.props.handleHover) {\n      this.props.handleHover(this.props.id);\n    }\n  };\n\n  private handleMouseOut = () => {\n    if (this.props.handleHoverLeave) {\n      this.props.handleHoverLeave(this.props.id);\n    }\n  };\n}\n\nexport default Card;\n","import { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport NestedMenuItem from \"material-ui-nested-menu-item\";\n\nexport interface ContextMenuItem {\n  label: string;\n  action?: () => void;\n  children?: ContextMenuItem[];\n}\n\ninterface IProps {\n  position: Vector2d;\n  items: ContextMenuItem[];\n  contextItemClicked?: (item: ContextMenuItem) => void;\n  hideContextMenu: () => void;\n}\n\ninterface IState {\n  menuOpen: boolean;\n}\n\nclass ContextMenu extends Component<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      menuOpen: true,\n    };\n  }\n\n  render() {\n    return (\n      <div\n        id=\"context-menu-layer\"\n        onContextMenu={this.preventDefault}\n        onClick={this.props.hideContextMenu}\n      >\n        <Menu\n          keepMounted\n          open={this.state.menuOpen}\n          onClose={this.handleMenuClosed}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            top: this.props.position.y + 8,\n            left: this.props.position.x + 8,\n          }}\n        >\n          {this.props.items.map((i, index) => this.renderMenuItem(i, index))}\n        </Menu>\n      </div>\n    );\n  }\n\n  private renderMenuItem = (i: ContextMenuItem, index: number) => {\n    return !!i.children ? (\n      <NestedMenuItem\n        key={`contextMenu-item-${index}`}\n        parentMenuOpen={this.state.menuOpen}\n        label={i.label}\n      >\n        {i.children.map((nestedI, nestedIndex) => {\n          return this.renderMenuItem(nestedI, index * 1000 + nestedIndex);\n        })}\n      </NestedMenuItem>\n    ) : (\n      <MenuItem\n        key={`contextMenu-item-${index}`}\n        onClick={this.handleContextItemClicked(i)}\n      >\n        {i.label}\n      </MenuItem>\n    );\n  };\n\n  private handleMenuClosed = () => {\n    this.setState({\n      menuOpen: false,\n    });\n    this.props.hideContextMenu();\n  };\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n\n  private handleContextItemClicked = (item: ContextMenuItem) => () => {\n    if (!!item.action) {\n      item.action();\n    }\n    if (!!this.props.contextItemClicked) {\n      this.props.contextItemClicked(this.props.items[0]);\n    }\n    if (!!item.action) {\n      this.props.hideContextMenu();\n    }\n  };\n}\n\nexport default ContextMenu;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\n\ninterface IProps {\n  loadDeckId: (id: number) => void;\n}\n\nclass DeckLoader extends Component<IProps> {\n  inputValue: string = \"\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          onClick={this.cancelBubble}\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n          type=\"number\"\n          variant=\"outlined\"\n        ></TextField>{\" \"}\n      </div>\n    );\n  }\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key.toLocaleLowerCase() === \"enter\") {\n      this.props.loadDeckId(+this.inputValue);\n    }\n  };\n}\n\nexport default DeckLoader;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { IEncounterEntity } from \"./features/cards-data/cards-data.selectors\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\nimport { GameType } from \"./constants/app-constants\";\ninterface IProps {\n  currentGameType: GameType;\n  encounterData: IEncounterEntity[];\n  loadCards: (cards: string[][]) => void;\n}\n\nclass EncounterLoader extends Component<IProps> {\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"encounter-loader-combobox\"\n          options={this.props.encounterData || []}\n          getOptionLabel={(option) => option.setData.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          renderInput={(params) => (\n            <TextField\n              {...params}\n              label={\n                GamePropertiesMap[this.props.currentGameType].encounterUiName\n              }\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleSelected = (_event: any, value: IEncounterEntity | null) => {\n    if (!!value) {\n      let questCards: string[] = [];\n      let encounterCards: string[] = [];\n      const filteredCards = value.cards\n        // We don't want cards that show up as another card's 'back_link' to be loaded as separate cards\n        .filter((c) => !value.cards.some((oc) => oc.backLink === c.code));\n\n      filteredCards\n        .filter((c) => c.typeCode.toLocaleLowerCase() === \"quest\")\n        .forEach((c) => {\n          questCards = questCards.concat(\n            Array.from({ length: c.quantity }).map((_i) => c.code)\n          );\n        });\n\n      filteredCards\n        .filter((c) => c.typeCode.toLocaleLowerCase() !== \"quest\")\n        .forEach((c) => {\n          encounterCards = encounterCards.concat(\n            Array.from({ length: c.quantity }).map((_i) => c.code)\n          );\n        });\n      let totalCards = [encounterCards];\n      if (questCards.length > 0) {\n        totalCards = [questCards].concat(totalCards);\n      }\n\n      this.props.loadCards(totalCards);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default EncounterLoader;\n","import { connect } from \"react-redux\";\nimport { GameType } from \"./constants/app-constants\";\nimport EncounterLoader from \"./EncounterLoader\";\nimport {\n  getCardsDataEncounterEntitiesBySetCode,\n  getCardsDataSetDataAsEncounterEntities,\n} from \"./features/cards-data/cards-data.selectors\";\n\nimport { RootState } from \"./store/rootReducer\";\n\ninterface IProps {\n  currentGameType: GameType;\n}\n\nconst mapStateToProps = (state: RootState, ownProps: IProps) => {\n  return {\n    encounterData:\n      ownProps.currentGameType === GameType.LordOfTheRingsLivingCardGame\n        ? getCardsDataSetDataAsEncounterEntities(state)\n        : getCardsDataEncounterEntitiesBySetCode(state),\n  };\n};\n\nconst EncounterLoaderContainer = connect(mapStateToProps, {})(EncounterLoader);\n\nexport default EncounterLoaderContainer;\n","import { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport \"./TopLayer.scss\";\n\ninterface IProps {\n  position: Vector2d;\n  completed: () => void;\n}\n\nclass TopLayer extends Component<IProps> {\n  render() {\n    const containerStyle: React.CSSProperties = {\n      top: `${this.props.position.y + 8}px`,\n      left: `${this.props.position.x + 8}px`,\n    };\n    return (\n      <div\n        id=\"top-layer\"\n        onClick={this.props.completed}\n        onContextMenu={this.preventDefault}\n      >\n        <div\n          className=\"top-layer-content-wrapper\"\n          style={containerStyle}\n          onContextMenu={this.preventDefault}\n          onClick={this.handleClick}\n        >\n          {this.props.children}\n        </div>\n      </div>\n    );\n  }\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.stopPropagation();\n    this.props.completed();\n  };\n\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n}\n\nexport default TopLayer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { CardData } from \"./external-api/common-card-data\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { AutocompleteHighlightChangeReason } from \"@material-ui/lab/useAutocomplete\";\ninterface IProps {\n  cardsDataEntities: ICardData;\n  card: ICardStack;\n  cardSelected: (jsonId: string) => void;\n  preview: (jsonId: string) => void;\n  clearPreview: () => void;\n}\n\nclass CardStackCardSelector extends Component<IProps> {\n  private cardsDataInStack: CardData[] = [];\n\n  constructor(props: IProps) {\n    super(props);\n    this.cardsDataInStack = props.card.cardStack.map((c) => {\n      return this.props.cardsDataEntities[c.jsonId];\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.clearPreview();\n  }\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"cardstack-card-selector-combobox\"\n          options={this.cardsDataInStack}\n          getOptionLabel={(option) => option.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          onHighlightChange={this.handleHighlightChange}\n          renderInput={(params) => (\n            <TextField {...params} label=\"Find Card...\" variant=\"outlined\" />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleHighlightChange = (\n    _event: any,\n    option: CardData | null,\n    reason: AutocompleteHighlightChangeReason\n  ) => {\n    if (!option) {\n      this.props.clearPreview();\n    } else {\n      this.props.preview(option.code);\n    }\n  };\n\n  private handleSelected = (_event: any, value: CardData | null) => {\n    this.props.clearPreview();\n    if (!!value && !!this.props.cardSelected) {\n      this.props.cardSelected(value.code);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default CardStackCardSelector;\n","import { connect } from \"react-redux\";\nimport CardStackCardSelector from \"./CardStackCardSelector\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport {\n  clearMenuPreviewCardJsonId,\n  setMenuPreviewCardJsonId,\n} from \"./features/game/game.slice\";\n\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    cardsDataEntities: getCardsDataEntities(state),\n  };\n};\n\nconst CardStackCardSelectorContainer = connect(mapStateToProps, {\n  preview: setMenuPreviewCardJsonId,\n  clearPreview: clearMenuPreviewCardJsonId,\n})(CardStackCardSelector);\n\nexport default CardStackCardSelectorContainer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Vector2d } from \"konva/types/types\";\nimport { Group, Rect, Text } from \"react-konva\";\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { PlayerColor } from \"./constants/app-constants\";\n\ninterface IProps {\n  id: string;\n  pos: Vector2d;\n  value: number;\n  color: PlayerColor;\n  updateCounterValueBy: (amount: number) => void;\n  handleContextMenu: (event: KonvaEventObject<PointerEvent>) => void;\n  onDragEnd: (event: KonvaEventObject<DragEvent>) => void;\n}\n\nclass Counter extends Component<IProps> {\n  private touchTimer: any = null;\n\n  render() {\n    return (\n      <Group\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onContextMenu={this.props.handleContextMenu}\n        onDragEnd={this.props.onDragEnd}\n        onTouchStart={this.handleTouchStart}\n        onTouchMove={this.handleTouchMove}\n        onTouchEnd={this.handleTouchEnd}\n      >\n        <Rect\n          cornerRadius={30}\n          width={200}\n          height={100}\n          fill={this.props.color}\n        ></Rect>\n        <Text\n          width={200}\n          height={100}\n          fontSize={36}\n          text={`${this.props.value}`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n        ></Text>\n        <Text\n          x={10}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`-`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleDecrement}\n          onTap={this.handleDecrement}\n        ></Text>\n        <Text\n          x={140}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`+`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleIncrement}\n          onTap={this.handleIncrement}\n        ></Text>\n      </Group>\n    );\n  }\n\n  private handleDecrement = () => {\n    this.props.updateCounterValueBy(-1);\n  };\n\n  private handleIncrement = () => {\n    this.props.updateCounterValueBy(1);\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.props.handleContextMenu(\n        (event as unknown) as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n}\n\nexport default Counter;\n","import { Component } from \"react\";\nimport * as React from \"react\";\ninterface IProps {\n  connect: (peerId: string) => void;\n}\n\nclass PeerConnector extends Component<IProps> {\n  public inputRef: HTMLInputElement | null = null;\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <input\n          ref={(ref) => {\n            if (!ref) return;\n            this.inputRef = ref;\n          }}\n        ></input>\n        <button onClick={this.connect}>Connect</button>\n      </div>\n    );\n  }\n\n  private connect = (_event: any) => {\n    console.log(\"connecting with peer id \" + this.inputRef?.value);\n\n    this.props.connect(this.inputRef?.value || \"\");\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default PeerConnector;\n","export const MISSING_CARD_IMAGE_MAP: { [key: string]: string } = {\n  \"02001a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".jpg\",\n\n  \"02001b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".b.jpg\",\n\n  \"02002a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".jpg\",\n\n  \"02002b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".b.jpg\",\n\n  \"02003a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".jpg\",\n\n  \"02003b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".b.jpg\",\n\n  \"02004\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".jpg\",\n\n  \"02004_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".b.jpg\",\n\n  \"02005\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".jpg\",\n\n  \"02005_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".b.jpg\",\n\n  \"02006a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".jpg\",\n\n  \"02006b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".b.jpg\",\n  \"12020\": \"https://lcgcdn.s3.amazonaws.com/mc/MC13en_20.jpg\",\n};\n","import * as React from \"react\";\nimport { Component } from \"react\";\nimport { CounterTokenType } from \"./features/cards/cards.slice\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\n\ninterface IProps {\n  id: string;\n  tokenType: CounterTokenType;\n  updated: (payload: {\n    id: string;\n    tokenType: CounterTokenType;\n    value: number;\n  }) => void;\n}\n\nclass TokenValueModifier extends Component<IProps> {\n  inputValue: string = \"0\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          variant=\"outlined\"\n          type=\"number\"\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n        ></TextField>\n        <Button\n          onClick={this.handleClick}\n          style={{ height: \"56px\", marginLeft: \"5px\" }}\n          variant=\"outlined\"\n          color=\"primary\"\n        >\n          Set\n        </Button>\n      </div>\n    );\n  }\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    if (code === \"enter\") {\n      this.complete(+this.inputValue);\n    }\n  };\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    this.complete(+this.inputValue);\n  };\n\n  private complete = (newValue: number) => {\n    this.props.updated({\n      id: this.props.id,\n      tokenType: this.props.tokenType,\n      value: newValue,\n    });\n  };\n\n  // private preventDefault = (\n  //   event: React.MouseEvent<HTMLElement, MouseEvent>\n  // ) => {\n  //   event.preventDefault();\n  // };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default TokenValueModifier;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Rect } from \"react-konva\";\nimport { Vector2d } from \"konva/types/types\";\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { GameType } from \"./constants/app-constants\";\n\ninterface IProps {\n  currentGameType: GameType;\n  pos: Vector2d;\n  updatePos: (newPos: Vector2d) => void;\n}\n\ninterface IState {\n  img: HTMLImageElement | null;\n}\n\nclass FirstPlayerToken extends Component<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      img: null,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        img: image,\n      });\n    };\n    image.src =\n      process.env.PUBLIC_URL +\n      \"/images/table/first_player_token_\" +\n      this.props.currentGameType +\n      \".png\";\n  }\n\n  render() {\n    return (\n      <Rect\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onDragEnd={this.handleDragEnd}\n        scale={{\n          x: 160 / (this.state.img?.naturalWidth ?? 1),\n          y: 160 / (this.state.img?.naturalWidth ?? 1),\n        }}\n        width={this.state.img?.naturalWidth ?? 0}\n        height={this.state.img?.naturalHeight ?? 0}\n        fillPatternImage={this.state.img ?? undefined}\n      ></Rect>\n    );\n  }\n\n  private handleDragEnd = (event: KonvaEventObject<DragEvent>) => {\n    this.props.updatePos({\n      x: event.target.x(),\n      y: event.target.y(),\n    });\n  };\n}\n\nexport default FirstPlayerToken;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\n\nexport const getCounters = (state: RootState) =>\n  state.liveState.present.counters;\n\nexport const getCurrentCounters = createSelector(getCounters, (counters) => {\n  return counters.counters;\n});\n\nexport const getFirstPlayerTokenPos = createSelector(\n  getCounters,\n  (counters) => counters.firstPlayerCounterPosition\n);\n","import { connect } from \"react-redux\";\nimport FirstPlayerToken from \"./FirstPlayerToken\";\nimport { moveFirstPlayerCounter } from \"./features/counters/counters.slice\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getFirstPlayerTokenPos } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    pos: getFirstPlayerTokenPos(state),\n  };\n};\n\nconst FirstPlayerTokenContainer = connect(mapStateToProps, {\n  updatePos: moveFirstPlayerCounter,\n})(FirstPlayerToken);\n\nexport default FirstPlayerTokenContainer;\n","import { ReactReduxContext, Provider } from \"react-redux\";\nimport * as Intersects from \"intersects\";\nimport Konva from \"konva\";\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Layer, Rect, Stage } from \"react-konva\";\nimport \"./Game.scss\";\nimport Card, { HORIZONTAL_TYPE_CODES } from \"./Card\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport ContextMenu, { ContextMenuItem } from \"./ContextMenu\";\nimport DeckLoader from \"./DeckLoader\";\nimport EncounterLoaderContainer from \"./EncounterLoaderContainer\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport {\n  CounterTokenType,\n  StatusTokenType,\n} from \"./features/cards/cards.slice\";\nimport { ICardsState, ICardStack } from \"./features/cards/initialState\";\nimport { IGameState } from \"./features/game/initialState\";\nimport TopLayer from \"./TopLayer\";\nimport { getCenter, getDistance } from \"./utilities/geo\";\nimport CardStackCardSelectorContainer from \"./CardStackCardSelectorContainer\";\nimport Counter from \"./Counter\";\nimport PeerConnector from \"./PeerConnector\";\nimport {\n  GameType,\n  myPeerRef,\n  PlayerColor,\n  possibleColors,\n} from \"./constants/app-constants\";\nimport { ICounter } from \"./features/counters/initialState\";\nimport { MISSING_CARD_IMAGE_MAP } from \"./constants/card-missing-image-map\";\nimport { CardData } from \"./external-api/common-card-data\";\nimport { CARD_PACK_REMAPPING } from \"./constants/card-pack-mapping\";\nimport { DrawCardsOutOfCardStackPayload } from \"./features/cards/cards.thunks\";\nimport TokenValueModifier from \"./TokenValueModifier\";\nimport FirstPlayerTokenContainer from \"./FirstPlayerTokenContainer\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\n\nconst SCALE_BY = 1.02;\n\ninterface IProps {\n  currentGameType: GameType;\n  cards: ICardsState;\n  cardsData: ICardData;\n  gameState: IGameState;\n  panMode: boolean;\n  playerColors: { [key: string]: PlayerColor };\n  menuPreviewCard: ICardStack | null;\n  cardMove: (info: { id: string; dx: number; dy: number }) => void;\n  endCardMove: (id: string) => void;\n  exhaustCard: (id?: string) => void;\n  selectCard: (payload: { id: string; unselectOtherCards: boolean }) => void;\n  unselectCard: (id: string) => void;\n  toggleSelectCard: (id: string) => void;\n  startCardMove: (payload: { id: string; splitTopCard: boolean }) => void;\n  unselectAllCards: (payload?: any) => void;\n  selectMultipleCards: (cards: { ids: string[] }) => void;\n  setPreviewCardId: (id: string) => void;\n  clearPreviewCard: () => void;\n  togglePanMode: () => void;\n  flipCards: () => void;\n  loadCardsData: () => void;\n  allJsonData: (payload: any) => void;\n  shuffleStack: (id?: string) => void;\n  fetchDecklistById: (payload: {\n    gameType: GameType;\n    decklistId: number;\n    position: Vector2d;\n  }) => void;\n  updateZoom: (zoom: Vector2d) => void;\n  updatePosition: (pos: Vector2d) => void;\n  resetApp: () => void;\n  addCardStack: (payload: {\n    cardJsonIds: string[];\n    position: Vector2d;\n  }) => void;\n  toggleToken: (payload: {\n    id: string;\n    tokenType: StatusTokenType;\n    value: boolean;\n  }) => void;\n  adjustCounterToken: (payload: {\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }) => void;\n  pullCardOutOfCardStack: (payload: {\n    cardStackId: string;\n    jsonId: string;\n    pos: Vector2d;\n  }) => void;\n  addNewCounter: (pos: Vector2d) => void;\n  updateCounterValue: (payload: { id: string; delta: number }) => void;\n  removeCounter: (id: string) => void;\n  moveCounter: (payload: { id: string; newPos: Vector2d }) => void;\n  connectToRemoteGame: (peerId: string) => void;\n  undo: () => void;\n  redo: () => void;\n  counters: ICounter[];\n  requestResync: () => void;\n  peerId: string;\n  dropTargetCardsById: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  };\n  drawCardsOutOfCardStack: (payload: DrawCardsOutOfCardStackPayload) => void;\n  quitGame: () => void;\n  updateCounterColor: (payload: { id: string; newColor: PlayerColor }) => void;\n}\n\ninterface IState {\n  drewASelectionRect: boolean;\n  selectRect: {\n    height: number;\n    width: number;\n  };\n  selectStartPos: {\n    x: number;\n    y: number;\n  };\n  selecting: boolean;\n  showContextMenu: boolean;\n  contextMenuPosition: Vector2d | null;\n  contextMenuItems: ContextMenuItem[];\n  showDeckImporter: boolean;\n  deckImporterPosition: Vector2d | null;\n  showEncounterImporter: boolean;\n  encounterImporterPosition: Vector2d | null;\n  showCardSearch: boolean;\n  cardSearchPosition: Vector2d | null;\n  cardStackForSearching: ICardStack | null;\n  showPeerConnector: boolean;\n  peerConnectorPosition: Vector2d | null;\n  showTokenValueModifier: boolean;\n  tokenValueModifierProps: { id: string; tokenType: CounterTokenType } | null;\n  tokenValueModifierPosition: Vector2d | null;\n  playmatImage: HTMLImageElement | null;\n}\nclass Game extends Component<IProps, IState> {\n  public stage: Konva.Stage | null = null;\n\n  private touchTimer: any = null;\n\n  private lastCenter: Vector2d | null = null;\n  private lastDist: number = 0;\n\n  constructor(props: IProps) {\n    super(props);\n\n    if (!!Konva) {\n      Konva.hitOnDragEnabled = true;\n    }\n\n    this.state = {\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selectStartPos: {\n        x: 0,\n        y: 0,\n      },\n      selecting: false,\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n      showDeckImporter: false,\n      deckImporterPosition: null,\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n      playmatImage: null,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        playmatImage: image,\n      });\n    };\n    image.src =\n      process.env.PUBLIC_URL +\n      \"/images/table/background_\" +\n      this.props.currentGameType +\n      \".jpg\";\n    this.props.loadCardsData();\n    this.props.allJsonData(\"\");\n  }\n\n  public render() {\n    // TODO: This feels like a bad hack. I bet all the\n    //       swallowing of click events is keeping\n    //       focus from behaving 'normally' and doing\n    //       the expected thing with focus. But there are\n    //       a lot of things that don't work quite right\n    //       if the body has focus, so we're going to\n    //       force the game area to have focus if it\n    //       lost it\n    if (document.activeElement === document.body) {\n      const el = document.querySelector(\".play-area\") as HTMLElement;\n      el?.focus();\n    }\n    // END HACK\n\n    const staticCards = this.props.cards.cards\n      .filter((card) => !card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            currentGameType={this.props.currentGameType}\n            code={this.getCardCode(card)}\n            name={this.getCardName(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dropTargetColor={\n              this.props.playerColors[\n                this.props.dropTargetCardsById[card.id]?.ownerRef\n              ] ?? \"\"\n            }\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            handleDoubleClick={this.handleSelectAndExhaust}\n            handleClick={this.handleCardClick(card)}\n            handleHover={this.props.setPreviewCardId}\n            handleHoverLeave={this.props.clearPreviewCard}\n            handleContextMenu={this.handleCardContextMenu}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n            cardState={{\n              stunned: card.statusTokens.stunned,\n              confused: card.statusTokens.confused,\n              tough: card.statusTokens.tough,\n              tokens: { damage: 0, threat: 0, generic: 0 },\n            }}\n          />\n        );\n      });\n\n    const ghostCards = this.props.cards.ghostCards.map((card) => {\n      return (\n        <Card\n          currentGameType={this.props.currentGameType}\n          name={this.getCardName(card)}\n          code={this.getCardCode(card)}\n          selectedColor={this.props.playerColors[card.controlledBy] ?? \"black\"}\n          controlledBy={card.controlledBy}\n          key={`ghost${card.id}`}\n          id={card.id}\n          x={card.x}\n          y={card.y}\n          exhausted={card.exhausted}\n          fill={card.fill}\n          selected={false}\n          dragging={false}\n          shuffling={false}\n          imgUrls={this.getImgUrls(card)}\n          typeCode={this.getCardType(card)}\n          faceup={card.faceup}\n          isGhost={true}\n        />\n      );\n    });\n\n    const movingCards = this.props.cards.cards\n      .filter((card) => card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            currentGameType={this.props.currentGameType}\n            name={this.getCardName(card)}\n            code={this.getCardCode(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n          />\n        );\n      });\n\n    const iAmDragging = this.props.cards.cards.some(\n      (c) => c.dragging && c.controlledBy === myPeerRef\n    );\n\n    const possiblePreviewCards = !!this.props.menuPreviewCard\n      ? [this.props.menuPreviewCard]\n      : this.props.cards.cards.filter(\n          (card) =>\n            !!this.props.gameState.previewCard &&\n            card.id === this.props.gameState.previewCard.id\n        );\n\n    const previewCards = this.stage\n      ? possiblePreviewCards\n          .filter((_card) => !this.state.selecting && !iAmDragging)\n          .map((card) => {\n            const isHorizontal = HORIZONTAL_TYPE_CODES.includes(\n              this.getCardType(card)\n            );\n            const imgUrls = this.getImgUrls(card);\n            const rawPos = this.getRawPreviewCardPosition(isHorizontal);\n            const previewPos = this.getRelativePositionFromTarget(\n              this.stage,\n              rawPos\n            );\n\n            return imgUrls.some(\n              (url) => url.indexOf(\"card_back\") !== -1\n            ) ? null : (\n              <Card\n                currentGameType={this.props.currentGameType}\n                name={this.getCardName(card)}\n                code={this.getCardCode(card)}\n                selectedColor={\n                  this.props.playerColors[card.controlledBy] ?? \"black\"\n                }\n                controlledBy={card.controlledBy}\n                key={`preview${card.id}`}\n                id={card.id}\n                x={previewPos.x}\n                y={previewPos.y}\n                exhausted={isHorizontal}\n                fill={card.fill}\n                selected={false}\n                dragging={false}\n                shuffling={false}\n                imgUrls={imgUrls}\n                typeCode={this.getCardType(card)}\n                faceup={card.faceup}\n                height={\n                  cardConstants.CARD_PREVIEW_HEIGHT /\n                  this.props.gameState.stageZoom.y\n                }\n                width={\n                  cardConstants.CARD_PREVIEW_WIDTH /\n                  this.props.gameState.stageZoom.x\n                }\n              />\n            );\n          })\n          .filter((c): c is JSX.Element => c !== null)\n      : [];\n\n    return (\n      <div\n        className=\"play-area\"\n        tabIndex={1}\n        onKeyDown={this.handleKeyDown}\n        onKeyPress={this.handleKeyPress}\n      >\n        {this.renderEmptyMessage()}\n        {this.renderContextMenu()}\n        {this.renderDeckImporter()}\n        {this.renderEncounterImporter()}\n        {this.renderCardSearch()}\n        {this.renderPeerConnector()}\n        {this.renderTokenModifier()}\n        <ReactReduxContext.Consumer>\n          {({ store }) => (\n            <Stage\n              ref={(ref) => {\n                if (!ref) return;\n\n                this.stage = ref;\n              }}\n              x={this.props.gameState.stagePosition.x}\n              y={this.props.gameState.stagePosition.y}\n              width={window.innerWidth}\n              height={window.innerHeight}\n              onClick={this.handleStageClickOrTap}\n              onTap={this.handleStageClickOrTap}\n              onMouseDown={\n                this.props.panMode ? this.noOp : this.handleMouseDown\n              }\n              onMouseUp={this.props.panMode ? this.noOp : this.handleMouseUp}\n              onMouseMove={\n                this.props.panMode ? this.noOp : this.handleMouseMove\n              }\n              onTouchStart={this.handleTouchStart}\n              onTouchMove={this.handleTouchMove}\n              onTouchEnd={this.handleTouchEnd}\n              onContextMenu={this.handleContextMenu}\n              scale={this.props.gameState.stageZoom}\n              onWheel={this.handleWheel}\n              draggable={this.props.panMode}\n              onDragMove={this.noOp}\n              onDragEnd={this.noOp}\n              preventDefault={true}\n            >\n              <Provider store={store}>\n                <Layer>\n                  <Rect\n                    scale={{\n                      x: 2880 / (this.state.playmatImage?.naturalWidth ?? 1),\n                      y: 2880 / (this.state.playmatImage?.naturalWidth ?? 1),\n                    }}\n                    width={this.state.playmatImage?.naturalWidth ?? 0}\n                    height={this.state.playmatImage?.naturalHeight ?? 0}\n                    fillPatternImage={this.state.playmatImage ?? undefined}\n                  ></Rect>\n                </Layer>\n                <Layer>\n                  {this.props.counters.map((counter) => (\n                    <Counter\n                      key={`${counter.id}-counter`}\n                      id={counter.id}\n                      pos={counter.position}\n                      value={counter.value}\n                      color={counter.color}\n                      updateCounterValueBy={this.handleCounterValueUpdate(\n                        counter.id\n                      )}\n                      handleContextMenu={this.handleCounterContextMenu(\n                        counter.id\n                      )}\n                      onDragEnd={this.handleCounterDrag(counter.id)}\n                    ></Counter>\n                  ))}\n                </Layer>\n                <Layer preventDefault={true}>\n                  {staticCards.concat(ghostCards).concat(movingCards)}\n                </Layer>\n                <Layer>\n                  <FirstPlayerTokenContainer\n                    currentGameType={this.props.currentGameType}\n                  ></FirstPlayerTokenContainer>\n                </Layer>\n                <Layer preventDefault={true}>{previewCards}</Layer>\n                <Layer>\n                  <Rect\n                    x={this.state.selectStartPos.x}\n                    y={this.state.selectStartPos.y}\n                    width={this.state.selectRect.width}\n                    height={this.state.selectRect.height}\n                    stroke=\"black\"\n                  />\n                </Layer>\n              </Provider>\n            </Stage>\n          )}\n        </ReactReduxContext.Consumer>\n      </div>\n    );\n  }\n\n  private handleCounterValueUpdate = (id: string) => (delta: number) => {\n    this.props.updateCounterValue({ id, delta });\n  };\n\n  private handleCounterDrag = (id: string) => (\n    event: KonvaEventObject<DragEvent>\n  ) => {\n    this.props.moveCounter({\n      id,\n      newPos: {\n        x: event.target.x(),\n        y: event.target.y(),\n      },\n    });\n  };\n\n  private noOp = () => {};\n\n  private renderEmptyMessage = () => {\n    if (this.props.cards.cards.length > 0) return null;\n\n    return (\n      <div>\n        Right click and select 'Load Deck ID' to load a deck from{\" \"}\n        {GamePropertiesMap[this.props.currentGameType].deckSite}\n      </div>\n    );\n  };\n\n  private renderContextMenu = () => {\n    if (!this.state.showContextMenu) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.contextMenuPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing context menu position\");\n    }\n\n    return (\n      <ContextMenu\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        items={this.state.contextMenuItems}\n        hideContextMenu={() => this.clearContextMenu()}\n      ></ContextMenu>\n    );\n  };\n\n  private renderDeckImporter = () => {\n    if (!this.state.showDeckImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.deckImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    return (\n      <TopLayer\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        completed={this.clearDeckImporter}\n      >\n        <DeckLoader\n          loadDeckId={this.handleImportDeck(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderEncounterImporter = () => {\n    if (!this.state.showEncounterImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.encounterImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return (\n      <TopLayer position={pos} completed={this.clearEncounterImporter}>\n        <EncounterLoaderContainer\n          currentGameType={this.props.currentGameType}\n          loadCards={this.handleLoadEncounter(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderCardSearch = () => {\n    if (!this.state.showCardSearch) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.cardSearchPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing card search position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.cardStackForSearching ? (\n      <TopLayer position={pos} completed={this.clearCardSearch}>\n        <CardStackCardSelectorContainer\n          card={this.state.cardStackForSearching}\n          cardSelected={this.handleCardSelectedFromCardStack(\n            this.state.cardStackForSearching.id,\n            pos\n          )}\n        />\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderPeerConnector = () => {\n    if (!this.state.showPeerConnector) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.peerConnectorPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing peer connector position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showPeerConnector ? (\n      <TopLayer position={pos} completed={this.clearPeerConnector}>\n        <PeerConnector connect={this.handlePeerConnect}></PeerConnector>\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderTokenModifier = () => {\n    if (!this.state.showTokenValueModifier) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.tokenValueModifierPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing token Modifier position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showTokenValueModifier &&\n      !!this.state.tokenValueModifierProps ? (\n      <TopLayer position={pos} completed={this.clearTokenValueModifier}>\n        <TokenValueModifier\n          id={this.state.tokenValueModifierProps.id}\n          tokenType={this.state.tokenValueModifierProps.tokenType}\n          updated={(payload) => {\n            this.props.adjustCounterToken(payload);\n            this.clearTokenValueModifier();\n          }}\n        ></TokenValueModifier>\n      </TopLayer>\n    ) : null;\n  };\n\n  private handleLoadEncounter = (position: Vector2d) => (cards: string[][]) => {\n    this.clearEncounterImporter();\n    cards.forEach((c, index) => {\n      this.props.addCardStack({\n        position: {\n          x: position.x + (cardConstants.CARD_WIDTH + 10) * index,\n          y: position.y,\n        },\n        cardJsonIds: c,\n      });\n    });\n  };\n\n  private handleImportDeck = (position: Vector2d) => (id: number) => {\n    this.clearDeckImporter();\n    this.props.fetchDecklistById({\n      gameType: this.props.currentGameType,\n      decklistId: id,\n      position,\n    });\n  };\n\n  private handlePeerConnect = (peerId: string) => {\n    this.clearPeerConnector();\n    this.props.connectToRemoteGame(peerId);\n  };\n\n  private handleCardSelectedFromCardStack = (\n    cardStackId: string,\n    pos: Vector2d\n  ) => (jsonId: string) => {\n    this.clearCardSearch();\n    this.props.pullCardOutOfCardStack({ cardStackId, jsonId, pos });\n  };\n\n  private clearContextMenu = () => {\n    this.setState({\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n    });\n  };\n\n  private clearDeckImporter = () => {\n    this.setState({\n      showDeckImporter: false,\n      deckImporterPosition: null,\n    });\n  };\n\n  private clearTokenValueModifier = () => {\n    this.setState({\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n    });\n  };\n\n  private clearEncounterImporter = () => {\n    this.setState({\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n    });\n  };\n\n  private clearCardSearch = () => {\n    this.setState({\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n    });\n  };\n\n  private clearPeerConnector = () => {\n    this.setState({\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n    });\n  };\n\n  private handleStageClickOrTap = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.state.showContextMenu) {\n      return;\n    }\n    const mousePos = this.getRelativePositionFromTarget(this.stage);\n    if (\n      this.props.panMode ||\n      getDistance(this.state.selectStartPos, mousePos) < 30\n    ) {\n      this.props.unselectAllCards();\n    }\n  };\n\n  private handleWheel = (event: KonvaEventObject<WheelEvent>) => {\n    event.evt.preventDefault();\n\n    if (!this.stage) return;\n\n    var oldScale = this.props.gameState.stageZoom.x;\n\n    const pointer = this.stage.getPointerPosition() ?? { x: 0, y: 0 };\n\n    const mousePointTo = {\n      x: (pointer.x - this.stage.x()) / oldScale,\n      y: (pointer.y - this.stage.y()) / oldScale,\n    };\n\n    const newScale =\n      event.evt.deltaY < 0 ? oldScale * SCALE_BY : oldScale / SCALE_BY;\n\n    this.props.updateZoom({ x: newScale, y: newScale });\n\n    const newPos = {\n      x: pointer.x - mousePointTo.x * newScale,\n      y: pointer.y - mousePointTo.y * newScale,\n    };\n\n    this.props.updatePosition(newPos);\n  };\n\n  private handleCounterContextMenu = (counterId: string) => (\n    event: KonvaEventObject<PointerEvent>\n  ) => {\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    const counter = this.props.counters.find((c) => c.id === counterId);\n\n    const menuItems: ContextMenuItem[] = [\n      {\n        label: \"Remove\",\n        action: () => {\n          this.props.removeCounter(counterId);\n        },\n      },\n      {\n        label: \"Reset\",\n        action: () => {\n          this.props.updateCounterValue({\n            id: counterId,\n            delta: (counter?.value ?? 0) * -1,\n          });\n        },\n      },\n      {\n        label: \"Set Color\",\n        children: possibleColors.map((color) => {\n          return {\n            label: color,\n            action: () => {\n              this.props.updateCounterColor({ id: counterId, newColor: color });\n            },\n          };\n        }),\n      },\n    ];\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private handleCardContextMenu = (\n    cardId: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => {\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    // We want to unselect all the other cards if the card isn't actively selected\n    const cardStack = this.props.cards.cards.find((c) => c.id === cardId);\n\n    // Next, select the card that was right-clicked\n    this.props.selectCard({\n      id: cardId,\n      unselectOtherCards: !!cardStack ? !cardStack.selected : true,\n    });\n\n    const card = this.props.cards.cards.find((c) => c.id === cardId);\n    const numCardsInStack = card?.cardStack?.length || 0;\n    const currentStatusTokens = card?.statusTokens || {\n      stunned: false,\n      confused: false,\n      tough: false,\n    };\n\n    const menuItems = [\n      {\n        label: \"Flip\",\n        action: () => {\n          this.props.flipCards();\n        },\n      },\n    ];\n\n    if (numCardsInStack > 1) {\n      menuItems.push({\n        label: \"Shuffle\",\n        action: () => {\n          this.props.shuffleStack();\n        },\n      });\n\n      menuItems.push({\n        label: \"Find Specific Card\",\n        action: () => {\n          if (!!card) {\n            this.setState({\n              showCardSearch: true,\n              cardSearchPosition: this.stage?.getPointerPosition() ?? null,\n              cardStackForSearching: card,\n            });\n          }\n        },\n      });\n    }\n\n    const tokenInfoForGameType =\n      GamePropertiesMap[this.props.currentGameType].tokens;\n\n    if (!!tokenInfoForGameType.stunned) {\n      menuItems.push({\n        label: !!currentStatusTokens.stunned\n          ? tokenInfoForGameType.stunned.menuRemoveText\n          : tokenInfoForGameType.stunned.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Stunned,\n            value: !currentStatusTokens.stunned,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.confused) {\n      menuItems.push({\n        label: !!currentStatusTokens.confused\n          ? tokenInfoForGameType.confused.menuRemoveText\n          : tokenInfoForGameType.confused.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Confused,\n            value: !currentStatusTokens.confused,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.tough) {\n      menuItems.push({\n        label: !!currentStatusTokens.tough\n          ? tokenInfoForGameType.tough.menuRemoveText\n          : tokenInfoForGameType.tough.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Tough,\n            value: !currentStatusTokens.tough,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.damage) {\n      menuItems.push({\n        label: tokenInfoForGameType.damage.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Damage,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.threat) {\n      menuItems.push({\n        label: tokenInfoForGameType.threat.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Threat,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.generic) {\n      menuItems.push({\n        label: tokenInfoForGameType.generic.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Generic,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    menuItems.push({\n      label: \"Remove All Tokens\",\n      action: () => {\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Damage,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Threat,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Generic,\n          value: 0,\n        });\n      },\n    });\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private handleCardClick = (card: ICardStack) => (\n    cardId: string,\n    event: KonvaEventObject<MouseEvent>\n  ) => {\n    // Here check if modifier held down\n    const modifierKeyHeld =\n      event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n\n    if (card.selected && modifierKeyHeld) {\n      this.props.toggleSelectCard(cardId);\n    } else {\n      this.props.selectCard({\n        id: cardId,\n        unselectOtherCards: !modifierKeyHeld,\n      });\n    }\n  };\n\n  private handleSelectAndExhaust = (\n    cardId: string,\n    event: KonvaEventObject<MouseEvent>\n  ) => {\n    // Here check if modifier held down\n    const modifierKeyHeld =\n      event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n    this.props.selectCard({ id: cardId, unselectOtherCards: !modifierKeyHeld });\n    this.props.exhaustCard(cardId);\n  };\n\n  private handleCardDragStart = (\n    cardId: string,\n    event: KonvaEventObject<DragEvent>\n  ) => {\n    let splitTopCard = false;\n    // If multiple things are selected, you can't pull something off the top of a stack,\n    // so just do a normal drag\n    const multipleSelected =\n      this.props.cards.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      ).length > 1;\n\n    if (!multipleSelected) {\n      const draggingCard = this.props.cards.cards.find((c) => c.id === cardId);\n      const hasStack = (draggingCard?.cardStack || []).length > 1;\n      if (!!draggingCard && hasStack) {\n        // Check if we're dragging in the upper right corner of the card\n        const upperRightPoint = {\n          x:\n            draggingCard.x +\n            (draggingCard.exhausted\n              ? cardConstants.CARD_HEIGHT\n              : cardConstants.CARD_WIDTH) /\n              2,\n          y:\n            draggingCard.y -\n            (draggingCard.exhausted\n              ? cardConstants.CARD_WIDTH\n              : cardConstants.CARD_HEIGHT) /\n              2,\n        };\n        const distance = getDistance(\n          upperRightPoint,\n          this.getRelativePositionFromTarget(this.stage)\n        );\n        if (distance < 50) {\n          splitTopCard = true;\n        }\n      }\n    }\n\n    this.props.startCardMove({ id: cardId, splitTopCard });\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLElement>) => {\n    const modifier: boolean = event.ctrlKey || event.metaKey;\n    const code = event.key.toLocaleLowerCase();\n    const intCode = parseInt(code);\n    if (code === \"p\") {\n      this.props.togglePanMode();\n    } else if (code === \"f\") {\n      this.props.flipCards();\n    } else if (code === \"e\") {\n      this.props.exhaustCard();\n    } else if (code === \"s\") {\n      this.props.shuffleStack();\n    } else if (!Number.isNaN(intCode)) {\n      // if a ctrl / cmd key was held, we're\n      // adding tokens\n      if (modifier) {\n      } else {\n        // First, get the selected card stack\n        const mySelectedCards = this.props.cards.cards.filter(\n          (c) => c.selected && c.controlledBy === myPeerRef\n        );\n        if (mySelectedCards.length !== 1) {\n          console.log(\n            \"will not be drawing any cards because the number of selected stacks is \" +\n              mySelectedCards.length\n          );\n        } else {\n          this.props.drawCardsOutOfCardStack({\n            cardStackId: mySelectedCards[0].id,\n            numberToDraw: intCode,\n          });\n        }\n      }\n    }\n  };\n\n  private handleKeyDown = (event: React.KeyboardEvent<HTMLElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    const intCode = parseInt(code);\n\n    if ((event.ctrlKey || event.metaKey) && !Number.isNaN(intCode)) {\n      const tokenInfoForGameType =\n        GamePropertiesMap[this.props.currentGameType].tokens;\n      switch (intCode) {\n        case 1:\n          if (!!tokenInfoForGameType.damage) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Damage,\n              delta: 1,\n            });\n          }\n          break;\n        case 2:\n          if (!!tokenInfoForGameType.threat) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Threat,\n              delta: 1,\n            });\n          }\n          break;\n\n        case 3:\n          if (!!tokenInfoForGameType.generic) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Generic,\n              delta: 1,\n            });\n          }\n          break;\n        case 4:\n          if (!!tokenInfoForGameType.damage) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Damage,\n              delta: -1,\n            });\n          }\n          break;\n        case 5:\n          if (!!tokenInfoForGameType.threat) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Threat,\n              delta: -1,\n            });\n          }\n          break;\n\n        case 6:\n          if (!!tokenInfoForGameType.generic) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Generic,\n              delta: -1,\n            });\n          }\n          break;\n      }\n      event.preventDefault();\n    }\n\n    if (\n      event.shiftKey &&\n      (event.ctrlKey || event.metaKey) &&\n      event.key === \"z\"\n    ) {\n      this.props.redo();\n    } else if ((event.ctrlKey || event.metaKey) && event.key === \"z\") {\n      event.preventDefault();\n      this.props.undo();\n    }\n  };\n\n  private getRawPreviewCardPosition = (horizontal: boolean): Vector2d => {\n    const pointerPos = this.stage?.getPointerPosition() ?? { x: 0, y: 0 };\n    const screenMidPointX = window.innerWidth / 2;\n\n    const widthToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_HEIGHT\n      : cardConstants.CARD_PREVIEW_WIDTH;\n    const heightToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_WIDTH\n      : cardConstants.CARD_PREVIEW_HEIGHT;\n\n    return pointerPos.x < screenMidPointX\n      ? {\n          x: window.innerWidth - widthToUse / 2,\n          y: heightToUse / 2,\n        }\n      : {\n          x: widthToUse / 2,\n          y: heightToUse / 2,\n        };\n  };\n\n  private getRelativePositionFromTarget = (\n    target: any,\n    posParam?: Vector2d\n  ) => {\n    const transform = target.getAbsoluteTransform().copy();\n    transform.invert();\n    let pos = posParam || target.getPointerPosition();\n    return transform.point(pos) as Vector2d;\n  };\n\n  private handleMouseDown = (event: KonvaEventObject<MouseEvent>) => {\n    if (event.evt.button === 0) {\n      // Only do something if it's the primary button (not a right-click)\n      const pos = this.getRelativePositionFromTarget(this.stage);\n\n      this.setState({\n        selectStartPos: {\n          x: pos.x,\n          y: pos.y,\n        },\n        selecting: true,\n      });\n    }\n\n    return false;\n  };\n\n  private getSelectionRectInfo = () => {\n    const selectStartPos = this.state.selectStartPos;\n    const selectRect = this.state.selectRect;\n    return {\n      height: Math.abs(selectRect.height),\n      width: Math.abs(selectRect.width),\n      x:\n        selectRect.width < 0\n          ? selectStartPos.x + selectRect.width\n          : selectStartPos.x,\n      y:\n        selectRect.height < 0\n          ? selectStartPos.y + selectRect.height\n          : selectStartPos.y,\n    };\n  };\n\n  private handleMouseUp = () => {\n    // if we were selecting, check for intersection\n    if (this.state.drewASelectionRect) {\n      const selectRect = this.getSelectionRectInfo();\n      const selectedCards: any[] = this.props.cards.cards.reduce<ICardStack[]>(\n        (currSelectedCards, card) => {\n          const intersects = Intersects.boxBox(\n            selectRect.x,\n            selectRect.y,\n            selectRect.width,\n            selectRect.height,\n            card.x - 50,\n            card.y - 75,\n            cardConstants.CARD_WIDTH,\n            cardConstants.CARD_HEIGHT\n          );\n\n          if (intersects) {\n            currSelectedCards.push(card);\n          }\n\n          return currSelectedCards;\n        },\n        []\n      );\n\n      this.props.selectMultipleCards({\n        ids: selectedCards.map((card) => card.id),\n      });\n    }\n\n    this.setState({\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selecting: false,\n    });\n\n    return false;\n  };\n\n  private handleTouchStart = (event: any) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(event);\n    }, 750);\n  };\n\n  private handleTouchMove = (e: any) => {\n    e.evt.preventDefault();\n\n    var touch1 = e.evt.touches[0];\n    var touch2 = e.evt.touches[1];\n\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    if (touch1 && touch2) {\n      this.handleMultiTouch(touch1, touch2);\n    } else if (!this.props.panMode) {\n      this.handleMouseMove(e);\n    }\n  };\n\n  private handleMultiTouch = (touch1: any, touch2: any) => {\n    if (!this.stage) {\n      return;\n    }\n    // if the stage was under Konva's drag&drop\n    // we need to stop it, and implement our own pan logic with two pointers\n    if (this.stage.isDragging()) {\n      this.stage.stopDrag();\n    }\n\n    const p1 = {\n      x: touch1.clientX,\n      y: touch1.clientY,\n    };\n    const p2 = {\n      x: touch2.clientX,\n      y: touch2.clientY,\n    };\n\n    if (!this.lastCenter) {\n      this.lastCenter = getCenter(p1, p2);\n      return;\n    }\n    const newCenter = getCenter(p1, p2);\n\n    const dist = getDistance(p1, p2);\n\n    if (!this.lastDist) {\n      this.lastDist = dist;\n    }\n\n    // local coordinates of center point\n    const pointTo = {\n      x: (newCenter.x - this.stage.x()) / this.props.gameState.stageZoom.x,\n      y: (newCenter.y - this.stage.y()) / this.props.gameState.stageZoom.y,\n    };\n\n    const scale = this.props.gameState.stageZoom.x * (dist / this.lastDist);\n    this.props.updateZoom({ x: scale, y: scale });\n\n    // calculate new position of the stage\n    const dx = newCenter.x - this.lastCenter.x;\n    const dy = newCenter.y - this.lastCenter.y;\n\n    const newPos = {\n      x: newCenter.x - pointTo.x * scale + dx,\n      y: newCenter.y - pointTo.y * scale + dy,\n    };\n\n    this.props.updatePosition(newPos);\n\n    this.lastDist = dist;\n    this.lastCenter = newCenter;\n  };\n\n  private handleTouchEnd = (event: any) => {\n    this.lastDist = 0;\n    this.lastCenter = null;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleMouseMove = (event: any) => {\n    if (this.state.selecting) {\n      const pos = this.getRelativePositionFromTarget(event.currentTarget);\n      this.setState({\n        drewASelectionRect: true,\n        selectRect: {\n          height: pos.y - this.state.selectStartPos.y,\n          width: pos.x - this.state.selectStartPos.x,\n        },\n      });\n    }\n    event.cancelBubble = true;\n  };\n\n  private handleContextMenu = (event: KonvaEventObject<PointerEvent>): void => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    const menuItems = [\n      {\n        label: \"Undo\",\n        action: this.props.undo,\n      },\n      {\n        label: \"Redo\",\n        action: this.props.redo,\n      },\n      {\n        label: \"Load Deck ID\",\n        action: () => {\n          this.setState({\n            showDeckImporter: true,\n            deckImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: `Load ${\n          GamePropertiesMap[this.props.currentGameType].encounterUiName\n        }`,\n        action: () => {\n          this.setState({\n            showEncounterImporter: true,\n            encounterImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Create new counter\",\n        action: () => {\n          this.props.addNewCounter(\n            this.getRelativePositionFromTarget(this.stage) ?? { x: 0, y: 0 }\n          );\n        },\n      },\n      { label: \"Reset Game\", action: this.props.resetApp },\n      {\n        label: \"Quit Game\",\n        action: () => {\n          this.props.quitGame();\n          this.props.resetApp();\n        },\n      },\n      {\n        label: \"Connect to Remote Game\",\n        action: () => {\n          this.setState({\n            showPeerConnector: true,\n            peerConnectorPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Request resync from Remote Game\",\n        action: this.props.requestResync,\n      },\n      {\n        label: `Peer id is ${this.props.peerId}`,\n        action: () => {},\n      },\n    ];\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private getCardType = (card: ICardStack): string => {\n    if (Object.keys(this.props.cardsData).length === 0) return \"\";\n\n    const cardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    return (cardData?.typeCode ?? \"\").toLocaleLowerCase();\n  };\n\n  private getCardName = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n    return this.props.cardsData[cardInQuestion.jsonId]?.name ?? \"\";\n  };\n\n  private getCardCode = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n    return (\n      this.props.cardsData[cardInQuestion.jsonId]?.code ??\n      `code missing for ${cardInQuestion.jsonId}`\n    );\n  };\n\n  private checkMissingImageMap(code: string): string | null {\n    return MISSING_CARD_IMAGE_MAP[code] ?? null;\n  }\n\n  private generateLCGCDNImageUrl(card: CardData, faceup: boolean): string {\n    if (!card) {\n      return `https://lcgcdn.s3.amazonaws.com/mc/NOPE.jpg`;\n    }\n\n    // get the first two digits\n    let codeToUse = card.code;\n\n    if (!faceup && !!card.backLink) {\n      codeToUse = card.backLink;\n    }\n\n    const groupCode =\n      CARD_PACK_REMAPPING[card.extraInfo.packCode ?? \"\"] ??\n      codeToUse.substring(0, 2);\n    let cardCode = codeToUse.substring(2);\n\n    //trim leading \"0\" chars\n    while (cardCode[0] === \"0\") {\n      cardCode = cardCode.substring(1);\n    }\n\n    cardCode = cardCode.toLocaleUpperCase();\n\n    let cardSuffix = \"\";\n\n    if (!!card.doubleSided) {\n      cardSuffix = faceup ? \"A\" : \"B\";\n    }\n\n    return `https://lcgcdn.s3.amazonaws.com/mc/MC${groupCode}en_${cardCode}${cardSuffix}.jpg`;\n  }\n\n  private getImgUrls = (card: ICardStack): string[] => {\n    if (Object.keys(this.props.cardsData).length === 0) return [];\n\n    let urls: string[] = [];\n\n    const topCardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    if (!topCardData) {\n      return [];\n    }\n\n    let cardData: CardData | null = topCardData;\n\n    if (!!cardData.images) {\n      if (!card.faceup) {\n        if (!cardData.images.back) {\n          return [\n            topCardData.extraInfo.factionCode === \"encounter\"\n              ? process.env.PUBLIC_URL +\n                \"/images/standard/encounter_card_back_\" +\n                this.props.currentGameType +\n                \".png\"\n              : process.env.PUBLIC_URL +\n                \"/images/standard/card_back_\" +\n                this.props.currentGameType +\n                \".png\",\n          ];\n        } else {\n          return [cardData.images.back];\n        }\n      } else {\n        return [cardData.images.front];\n      }\n    }\n\n    if (!card.faceup) {\n      if (!!topCardData.backLink || !!topCardData.doubleSided) {\n        urls = [\n          this.generateLCGCDNImageUrl(topCardData, card.faceup),\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.png`,\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.jpg`,\n          // process.env.PUBLIC_URL +\n          //   \"/images/cards/\" +\n          //   bottomCardData.octgn_id +\n          //   \".b.jpg\",\n        ];\n      } else {\n        cardData = null;\n        urls = [\n          topCardData.extraInfo.factionCode === \"encounter\"\n            ? process.env.PUBLIC_URL +\n              \"/images/standard/encounter_card_back_\" +\n              this.props.currentGameType +\n              \".png\"\n            : process.env.PUBLIC_URL +\n              \"/images/standard/card_back_\" +\n              this.props.currentGameType +\n              \".png\",\n        ];\n      }\n    } else {\n      urls = [\n        this.generateLCGCDNImageUrl(topCardData, card.faceup),\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.png`,\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.jpg`,\n        // process.env.PUBLIC_URL +\n        //   \"/images/cards/\" +\n        //   topCardData.octgn_id +\n        //   \".jpg\",\n      ];\n    }\n\n    let codeForMissingCheck = \"\";\n\n    if (!!cardData) {\n      if (card.faceup) {\n        codeForMissingCheck = cardData.code;\n      } else {\n        if (!!cardData.backLink) {\n          codeForMissingCheck = cardData.backLink;\n        } else if (cardData.doubleSided) {\n          codeForMissingCheck = `${cardData.code}_double_sided_back`;\n        }\n      }\n    }\n\n    const missingImageOverride = !!cardData\n      ? this.checkMissingImageMap(codeForMissingCheck)\n      : null;\n\n    if (!!missingImageOverride) {\n      urls.unshift(missingImageOverride);\n    }\n\n    return urls;\n  };\n}\n\nexport default Game;\n","export const packList = [\n\"ant.json\",\n\"ant_encounter.json\",\n\"bkw.json\",\n\"bkw_encounter.json\",\n\"cap.json\",\n\"cap_encounter.json\",\n\"core.json\",\n\"core_encounter.json\",\n\"drs.json\",\n\"drs_encounter.json\",\n\"gob_encounter.json\",\n\"hlk.json\",\n\"hlk_encounter.json\",\n\"msm.json\",\n\"msm_encounter.json\",\n\"qsv.json\",\n\"qsv_encounter.json\",\n\"ron_encounter.json\",\n\"thor.json\",\n\"thor_encounter.json\",\n\"toafk_encounter.json\",\n\"trors.json\",\n\"trors_encounter.json\",\n\"twc_encounter.json\",\n\"wsp.json\",\n\"wsp_encounter.json\",\n];","export const packList = [\n\"A Journey To Rhosgobel.json\",\n\"A Journey to Rhosgobel Nightmare.json\",\n\"A Knife in the Dark Nightmare.json\",\n\"A Shadow in the East.json\",\n\"A Shadow of the Past Nightmare.json\",\n\"A Storm on Cobas Haven Nightmare.json\",\n\"A Storm on Cobas Haven.json\",\n\"Across the Ettenmoors Nightmare.json\",\n\"Across the Ettenmoors.json\",\n\"Among the Outlaws.json\",\n\"Assault on Osgiliath Nightmare.json\",\n\"Assault on Osgiliath.json\",\n\"Attack on Dol Guldur.json\",\n\"Beneath the Sands.json\",\n\"Breaking of the Fellowship Nightmare.json\",\n\"Celebrimbor's Secret Nightmare.json\",\n\"Celebrimbor's Secret.json\",\n\"Challenge of the Wainriders.json\",\n\"Children of Eorl.json\",\n\"Conflict at the Carrock Nightmare.json\",\n\"Conflict at the Carrock.json\",\n\"Core Set.json\",\n\"Deadmen's Dike Nightmare.json\",\n\"Dungeons Deep and Caverns Dim Nightmare.json\",\n\"Encounter at Amon Dn Nightmare.json\",\n\"Encounter at Amon Dn.json\",\n\"Escape From Dol Guldur Nightmare.json\",\n\"Escape from Khazad-dm.json\",\n\"Escape from Mount Gram Nightmare.json\",\n\"Escape from Mount Gram.json\",\n\"Fire in the Night.json\",\n\"First Age.json\",\n\"Flies and Spiders Nightmare.json\",\n\"Flight from Moria Nightmare.json\",\n\"Flight of the Stormcaller Nightmare.json\",\n\"Flight of the Stormcaller.json\",\n\"Flight to the Ford Nightmare.json\",\n\"Fog on the Barrow-downs.json\",\n\"Foundations of Stone Nightmare.json\",\n\"Foundations of Stone.json\",\n\"Heirs of Nmenor.json\",\n\"Helm's Deep Nightmare.json\",\n\"Into Fangorn Nightmare.json\",\n\"Into Ithilien Nightmare.json\",\n\"Into the Pit Nightmare.json\",\n\"Intruders in Chetwood Nightmare.json\",\n\"Journey Along the Anduin Nightmare.json\",\n\"Journey in the Dark Nightmare.json\",\n\"Journey to the Cross-roads Nightmare.json\",\n\"Khazad-dm.json\",\n\"Mount Gundabad.json\",\n\"Murder at the Prancing Pony.json\",\n\"Over the Misty Mountains Grim Nightmare.json\",\n\"Passage Through Mirkwood Nightmare.json\",\n\"Peril in Pelargir Nightmare.json\",\n\"Race Across Harad.json\",\n\"Raid on the Grey Havens Nightmare.json\",\n\"Return to Mirkwood Nightmare.json\",\n\"Return to Mirkwood.json\",\n\"Road to Rivendell Nightmare.json\",\n\"Road to Rivendell.json\",\n\"Roam Across Rhovanion.json\",\n\"Shadow and Flame Nightmare.json\",\n\"Shadow and Flame.json\",\n\"Shelob's Lair Nightmare.json\",\n\"Temple of the Deceived Nightmare.json\",\n\"Temple of the Deceived.json\",\n\"The Antlered Crown Nightmare.json\",\n\"The Antlered Crown.json\",\n\"The Battle of Carn Dm Nightmare.json\",\n\"The Battle of Carn Dm.json\",\n\"The Battle of Five Armies Nightmare.json\",\n\"The Battle of Lake-town.json\",\n\"The Betrayal of Mm.json\",\n\"The Black Riders.json\",\n\"The Black Serpent.json\",\n\"The Blood of Gondor Nightmare.json\",\n\"The Blood of Gondor.json\",\n\"The City of Corsairs Nightmare.json\",\n\"The City of Corsairs.json\",\n\"The City of Ulfast.json\",\n\"The Crossings of Poros.json\",\n\"The Dead Marshes Nightmare.json\",\n\"The Dead Marshes.json\",\n\"The Dread Realm Nightmare.json\",\n\"The Dread Realm.json\",\n\"The Drowned Ruins Nightmare.json\",\n\"The Drowned Ruins.json\",\n\"The Dradan Forest Nightmare.json\",\n\"The Dradan Forest.json\",\n\"The Dungeons of Cirith Gurat.json\",\n\"The Dunland Trap Nightmare.json\",\n\"The Dunland Trap.json\",\n\"The Fall of Nargothrond.json\",\n\"The Fate of Nmenor Nightmare.json\",\n\"The Fate of Wilderland.json\",\n\"The Flame of the West.json\",\n\"The Fords of Isen Nightmare.json\",\n\"The Fortress of Nurn.json\",\n\"The Ghost of Framsburg.json\",\n\"The Grey Havens.json\",\n\"The Hills of Emyn Muil Nightmare.json\",\n\"The Hills of Emyn Muil.json\",\n\"The Hobbit: On the Doorstep.json\",\n\"The Hobbit: Over Hill and Under Hill.json\",\n\"The Hunt for Gollum Nightmare.json\",\n\"The Hunt for Gollum.json\",\n\"The Hunt for the Dreadnaught.json\",\n\"The Land of Shadow.json\",\n\"The Land of Sorrow.json\",\n\"The Lonely Mountain Nightmare.json\",\n\"The Long Dark Nightmare.json\",\n\"The Long Dark.json\",\n\"The Lost Realm.json\",\n\"The Massing at Osgiliath.json\",\n\"The Mines of Moria.json\",\n\"The Morgul Vale Nightmare.json\",\n\"The Morgul Vale.json\",\n\"The Mountain of Fire.json\",\n\"The Mmakil.json\",\n\"The Nn-in-Eilph Nightmare.json\",\n\"The Nn-in-Eilph.json\",\n\"The Old Forest.json\",\n\"The Passage of the Marshes Nightmare.json\",\n\"The Redhorn Gate Nightmare.json\",\n\"The Redhorn Gate.json\",\n\"The Ring Goes South Nightmare.json\",\n\"The Road Darkens.json\",\n\"The Road to Isengard Nightmare.json\",\n\"The Ruins of Belegost.json\",\n\"The Sands of Harad.json\",\n\"The Seventh Level Nightmare.json\",\n\"The Siege of Annminas.json\",\n\"The Siege of Cair Andros Nightmare.json\",\n\"The Steward's Fear Nightmare.json\",\n\"The Steward's Fear.json\",\n\"The Stone of Erech.json\",\n\"The Thing in the Depths Nightmare.json\",\n\"The Thing in the Depths.json\",\n\"The Three Trials Nightmare.json\",\n\"The Three Trials.json\",\n\"The Treachery of Rhudaur Nightmare.json\",\n\"The Treachery of Rhudaur.json\",\n\"The Treason of Saruman.json\",\n\"The Uruk-hai Nightmare.json\",\n\"The Voice of Isengard.json\",\n\"The Wastes of Eriador Nightmare.json\",\n\"The Wastes of Eriador.json\",\n\"The Watcher in the Water Nightmare.json\",\n\"The Watcher in the Water.json\",\n\"The Weather Hills Nightmare.json\",\n\"The Wilds of Rhovanion.json\",\n\"The Withered Heath.json\",\n\"The Wizard's Quest.json\",\n\"The Woodland Realm.json\",\n\"To Catch an Orc Nightmare.json\",\n\"Trial Upon the Marches.json\",\n\"Trouble in Tharbad Nightmare.json\",\n\"Trouble in Tharbad.json\",\n\"Two-Player Limited Edition Starter.json\",\n\"Under the Ash Mountains.json\",\n\"Voyage Across Belegaer Nightmare.json\",\n\"We Must Away, Ere Break of Day Nightmare.json\",\n\"Wrath and Ruin.json\",\n];","import { Action, ThunkAction } from \"@reduxjs/toolkit\";\nimport axios, { AxiosResponse } from \"axios\";\nimport { CardPack as CardPackMarvel } from \"../../external-api/marvel-card-data\";\nimport {\n  CardPack as CardPackLOTR,\n  Scenario,\n} from \"../../external-api/beorn-json-data\";\nimport { packList as marvelPackList } from \"../../generated/packsList\";\nimport { packList as lotrPackList } from \"../../generated/packsList_lotr\";\nimport scenarioListLOTR from \"../../external/ringsteki-json-data/scenarios.json\";\nimport { RootState } from \"../../store/rootReducer\";\nimport {\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} from \"./cards-data.slice\";\nimport { GameType } from \"../../constants/app-constants\";\n\nexport const allJsonData = (): ThunkAction<\n  void,\n  RootState,\n  unknown,\n  Action<string>\n> => async (dispatch) => {\n  let resultsList = await Promise.all(\n    marvelPackList.map((pack) => getSpecificMarvelPack(pack))\n  );\n\n  resultsList.forEach((result) => {\n    if (result.res.status === 200) {\n      dispatch(\n        loadCardsDataForPack({\n          packType: GameType.MarvelChampions,\n          pack: result.res.data as any,\n          pack_code: result.packCode,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n\n  const resultsListLOTR = await Promise.all(\n    lotrPackList.map((pack) => getSpecificLOTRPack(pack))\n  );\n\n  resultsListLOTR.forEach((result) => {\n    if (result.res.status === 200) {\n      dispatch(\n        loadCardsDataForPack({\n          packType: GameType.LordOfTheRingsLivingCardGame,\n          pack: result.res.data as any,\n          pack_code: result.packCode,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n\n  const resultsListLOTRScenarios = await Promise.all(\n    scenarioListLOTR.map((scenario) => getSpecificLOTRScenario(scenario.Title))\n  );\n\n  resultsListLOTRScenarios.forEach((result) => {\n    if (result.status === 200) {\n      dispatch(\n        loadCardsForEncounterSet({\n          setCode: result.data.Slug,\n          cards: result.data.AllCards,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n};\n\nconst getSpecificMarvelPack = async (\n  packName: string\n): Promise<{ res: AxiosResponse<CardPackMarvel>; packCode: string }> => {\n  const response = await axios.get<CardPackMarvel>(\n    process.env.PUBLIC_URL + \"/json_data/\" + packName\n  );\n  return {\n    res: response,\n    packCode: packName.split(\".json\")[0],\n  };\n};\n\nconst getSpecificLOTRPack = async (\n  packName: string\n): Promise<{ res: AxiosResponse<CardPackLOTR>; packCode: string }> => {\n  const response = await axios.get<CardPackLOTR>(\n    process.env.PUBLIC_URL + \"/json_data/\" + packName\n  );\n  return {\n    res: response,\n    packCode: packName.split(\".json\")[0],\n  };\n};\n\nconst getSpecificLOTRScenario = async (\n  scenario: string\n): Promise<AxiosResponse<Scenario>> => {\n  const response = await axios.get<Scenario>(\n    process.env.PUBLIC_URL + \"/json_data/scenarios/\" + scenario + \".json\"\n  );\n  return response;\n};\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"../cards/initialState\";\n\nexport const getGame = (state: RootState) => state.game;\n\nexport const getCurrentZoom = createSelector(getGame, (game) => {\n  return game.stageZoom;\n});\n\nexport const getPlayerColors = createSelector(getGame, (game) => {\n  return game.playerColors;\n});\n\nexport const getPeerId = createSelector(getGame, (game) => game.peerId);\n\nexport const getActiveGameType = createSelector(\n  getGame,\n  (game) => game.activeGameType\n);\n\nexport const getMenuPreviewCard = createSelector(getGame, (game) => {\n  if (!game.menuPreviewCardJsonId) return null;\n\n  const menuPreviewCard: ICardStack = {\n    id: \"menu-preview-card\",\n    controlledBy: \"\",\n    exhausted: false,\n    faceup: true,\n    fill: \"gray\",\n    x: 0,\n    y: 0,\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n    selected: false,\n    dragging: false,\n    shuffling: false,\n    cardStack: [{ jsonId: game.menuPreviewCardJsonId }],\n  };\n\n  return menuPreviewCard;\n});\n","import { connect } from \"react-redux\";\nimport { ActionCreators } from \"redux-undo\";\nimport Game from \"./Game\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport { loadCardsData } from \"./features/cards-data/cards-data.slice\";\nimport {\n  getCards,\n  getDropTargetCardsById,\n  getPanMode,\n} from \"./features/cards/cards.selectors\";\nimport {\n  adjustCounterToken,\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  flipCards,\n  selectCard,\n  selectMultipleCards,\n  togglePanMode,\n  toggleSelectCard,\n  toggleToken,\n  unselectAllCards,\n  unselectCard,\n} from \"./features/cards/cards.slice\";\nimport {\n  addCardStack,\n  fetchDecklistById,\n  pullCardOutOfCardStack,\n  startCardMove,\n  shuffleStack,\n  drawCardsOutOfCardStack,\n} from \"./features/cards/cards.thunks\";\nimport { allJsonData } from \"./features/cards-data/cards-data.thunks\";\nimport {\n  getGame,\n  getMenuPreviewCard,\n  getPeerId,\n  getPlayerColors,\n} from \"./features/game/game.selectors\";\nimport {\n  connectToRemoteGame,\n  updatePosition,\n  updateZoom,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n  quitGame,\n} from \"./features/game/game.slice\";\n\nimport {\n  moveCounter,\n  removeCounter,\n  updateCounterValue,\n  updateCounterColor,\n} from \"./features/counters/counters.slice\";\nimport { addNewCounter } from \"./features/counters/counters.thunks\";\nimport { resetApp } from \"./store/global.actions\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getCurrentCounters } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    playerColors: getPlayerColors(state),\n    cards: getCards(state),\n    cardsData: getCardsDataEntities(state),\n    panMode: getPanMode(state),\n    gameState: getGame(state),\n    counters: getCurrentCounters(state),\n    peerId: getPeerId(state),\n    dropTargetCardsById: getDropTargetCardsById(state),\n    menuPreviewCard: getMenuPreviewCard(state),\n  };\n};\n\nconst GameContainer = connect(mapStateToProps, {\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  loadCardsData,\n  allJsonData,\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  selectMultipleCards,\n  startCardMove,\n  unselectAllCards,\n  togglePanMode,\n  flipCards,\n  shuffleStack,\n  fetchDecklistById,\n  updateZoom,\n  updatePosition,\n  resetApp,\n  addCardStack,\n  toggleToken,\n  adjustCounterToken,\n  pullCardOutOfCardStack,\n  addNewCounter,\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  connectToRemoteGame,\n  requestResync,\n  undo: ActionCreators.undo,\n  redo: ActionCreators.redo,\n  drawCardsOutOfCardStack,\n  setPreviewCardId,\n  clearPreviewCard,\n  quitGame,\n  updateCounterColor,\n})(Game);\n\nexport default GameContainer;\n","import { Vector2d } from \"konva/types/types\";\nimport { Action } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { addNewCounterWithId } from \"./counters.actions\";\n\nexport const addNewCounter = (\n  pos: Vector2d\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    pos,\n    id: uuidv4(),\n  };\n  dispatch(addNewCounterWithId(payloadWithId));\n};\n","import TextField from \"@material-ui/core/TextField\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport React from \"react\";\nimport { GameType } from \"./constants/app-constants\";\nimport GameContainer from \"./GameContainer\";\nimport \"./App.scss\";\ninterface IProps {\n  activeGameType: GameType | null;\n  updateActiveGameType: (val: GameType) => void;\n}\n\nconst App = (props: IProps) => {\n  return !!props.activeGameType ? (\n    <GameContainer currentGameType={props.activeGameType}></GameContainer>\n  ) : (\n    renderGamePicker(props)\n  );\n};\n\nconst camelCaseToSpaces = (str: string) => {\n  // insert a space before all caps\n  return (\n    str\n      .replace(/([A-Z])/g, \" $1\")\n      // uppercase the first character\n      .replace(/^./, (s) => {\n        return s.toUpperCase();\n      })\n  );\n};\n\nconst renderGamePicker = (props: IProps) => {\n  return (\n    <div className=\"game-picker\">\n      <h1>Card Game Playground</h1>\n      <Autocomplete\n        id=\"game-picker\"\n        options={Object.entries(GameType).map(([key, value]) => {\n          return { key, value };\n        })}\n        getOptionLabel={(option) => camelCaseToSpaces(option.key)}\n        style={{ width: 300 }}\n        onChange={(_e, value) => {\n          if (!!value) props.updateActiveGameType(value.value);\n        }}\n        renderInput={(params) => (\n          <TextField {...params} label=\"Choose Game\" variant=\"outlined\" />\n        )}\n      />\n    </div>\n  );\n};\n\nexport default App;\n","import { connect } from \"react-redux\";\nimport App from \"./App\";\nimport { getActiveGameType } from \"./features/game/game.selectors\";\nimport { updateActiveGameType } from \"./features/game/game.slice\";\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    activeGameType: getActiveGameType(state),\n  };\n};\n\nconst AppContainer = connect(mapStateToProps, {\n  updateActiveGameType,\n})(App);\n\nexport default AppContainer;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport { Provider } from \"react-redux\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport configureStore from \"./store/configureStore\";\nimport AppContainer from \"./AppContainer\";\n\nconst store = configureStore();\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <AppContainer />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}